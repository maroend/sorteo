/*   
App Sorteo Anáhuac
Version: 1.0
Website: http://www.redanahuac.mx/app/sorteo
*/


var pag = 1;



var guardarPermiso=function(){"use strict";return{init:function(){ 
	
	handlecontrollersave();
	
}}}()



function BuscarEditar(idpermiso){ 
	
	
	$('#alerta').hide();
	$("#guardar").text('Editar');    	
	$("#guardar").attr("onClick", "javascript:Editar('"+idpermiso+"');return false;");
	
	
	
	
    	 $('div.block').block({ 
 		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
 	        overlayCSS: {backgroundColor: '#FFF'},
 	         message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
       }); 
 	
     
 	$.ajax({ 
 	    type: "GET",  
 	    cache: false,
 	    url: "Permisos",  
 	    data: "view=BuscarEditar&idpermiso="+idpermiso,  
 	    success: function(msg){  
 	    	
 	    	
 	    	$('div.block').unblock();    	
 	    	 $('html, body').animate({scrollTop:0}, 10);
 	    	
 	    	var contenido = msg.split('#%#');
 	    	
 	    	 $('#idpermiso').val(contenido[0]); 	    	 
 	    	 $('#permiso').val(contenido[1]);
 	    	 $("#tipo option[value="+ contenido[2] +"]").attr("selected",true);    	
 	    	 $('#descripcion').val(contenido[3]);
 	    	 
 	    	 
 	    	
 	    	
 	    	
 	        } 
 	   
 	   });
    	
    	
    	
    	
    }
    
    
    
    
    
    
function Editar(idpermiso){
	
	
$('#alerta').hide();
	
	
if( $('#formulario').parsley().validate() ){    		 
        
  		
      
	
	var idpermiso = $('#idpermiso').val();    	
	var permiso = $('#permiso').val();
	var tipo = $('#tipo').val();
	var descripcion = $('#descripcion').val();

	
	 $('div.block').block({ 
		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
	        overlayCSS: {backgroundColor: '#FFF'},
	         message: '<img src="assets/img/load-search.gif" /><br><h2> Editando..</h2>'
   }); 
	
 
	$.ajax({ 
	    type: "GET",  
	    cache: false,
	    url: "Permisos",  
	    data: "view=Editar&idpermiso="+idpermiso+"&permiso="+permiso+"&tipo="+tipo+"&descripcion="+descripcion,  
	    success: function(msg){ 
	    	
	      
	    	
	   	    $("#guardar").attr("onClick", "javascript:Guardar();return false;");  
	    	$("#guardar").text('Guardar'); 
	    	
	    	$('div.block').unblock();    	
	    	BuscarPermisos();
	    	
	    	//$('#formulario').parsley().reset();
	    	
	         $("#tipo option").prop("selected", false); 	    	
	    	 $('#idpermiso').val("");
	    	 $('#permiso').val("");
	    	 $('#descripcion').val("");
	    	 
	    	
	         if(msg.trim()==""){ 
	    		    
	        	     $('html, body').animate({scrollTop:0}, 10);
	    	    	 $("#alerta").fadeIn();
			      	 $("#alerta").removeClass();
                     $("#alerta").addClass("alert alert-success");
			      // $("#headAlerta").html("¡Correcto!");
				     $("#bodyAlerta").html("Se ha editado con exito el permiso"); 	
	    		
	    	   }else{
	    		   
	    		   $('html, body').animate({scrollTop:0}, 10);
					$("#alerta").fadeIn();
					$("#alerta").removeClass();
	                $("#alerta").addClass("alert alert-error");
					//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
					$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se edito el permiso correctamente, por favor intentalo editar nuevamente."); 
	    		   
	    		   
	    	   }
	    	   
        	
	    	
	    	
	        } 
	   
	   });
	
}
return false;
	
	
}

    


 function Guardar(){
    	
    	$('#alerta').hide();
    	
    	if( $('#formulario').parsley().validate() ){    		 
            
   		 guardarPermiso.init();
        }
        return false;
    	
    	
    	
    	
    }  





function permitirPermisos(id){
	
var generar=false;

var listapermisos = new Array() 
var cont=0;

 var permisos ="";
 var rol= gup('idrole');
 
 if(document.forms.namedItem("form"+id).elements.namedItem("checkboxall"+id).checked==1)
{
	 
	 
for (i=0;i<document.forms.namedItem("form"+id).elements.length;i++)
{ 
    if(document.forms.namedItem("form"+id).elements[i].type == "checkbox")
	  { 
       if(document.forms.namedItem("form"+id).elements[i].checked==1)
		 {
		   listapermisos[cont]=document.forms.namedItem("form"+id).elements[i].value; 
		   cont+=1;
		 // alert(document.form.elements[i].value);
		 generar=true;
		 } 
	  }
}
}
else if(document.forms.namedItem("form"+id).elements.namedItem("checkboxall"+id).checked==0)
{
listapermisos[cont]=document.forms.namedItem("form"+id).elements.namedItem("checkboxall"+id).value; 
for (i=0;i<document.forms.namedItem("form"+id).elements.length;i++)
{ 
    if(document.forms.namedItem("form"+id).elements[i].type == "checkbox")
	  { 
       if(document.forms.namedItem("form"+id).elements[i].checked==1)
		 {
		 cont+=1;
		 
		 listapermisos[cont]=document.forms.namedItem("form"+id).elements[i].value; 
		//alert(document.form.elements[i].value);
		 generar=true;
		 
		 } 
	  }
}

}
 

for(j=1;j<=listapermisos.length-1;j++)
{
//alert(document.getElementById('labelNRC'+listacursos[j]));
if(j==1){
permisos+=listapermisos[j];
permisos+="-";
//alert(id);
}
else{
permisos+=listapermisos[j];
permisos+="-";
//alert(idcurso);
}
}
 
if(generar==true){
	
	
	$.ajax({ 
	    type: "POST",  
	    cache: false,
	    url: "Permisos?permitirpermiso=true&Rol="+rol,  
	    data: {permisos:permisos,Rol:rol},
	    success: function(msg){  	    
	
	    	BuscarPermisos();
	    	
	    	$.gritter.add({title:"PERMISOS ACTIVADOS",text:"Se han permitido los permisos al rol con exito"});
			

             } 
 
         });
		   }else{
			   
	 $('#titlemodal').html('¡Alerta!');
	 $('#bodymodal').html('Debe elegir al menos un permiso a modificar');
	 $("#cancelarmodal").hide();
	 $("#aceptarmodal").attr("data-dismiss", "modal");
   $('#myModal').modal('show');  	
	
		   }
	
}



function restringirPermisos(id){
var generar=false;

var listapermisos = new Array() 
var cont=0;

 var permisos ="";
 var rol= gup('idrole');
 
 if(document.forms.namedItem("form"+id).elements.namedItem("checkboxall"+id).checked==1)
{
for (i=0;i<document.forms.namedItem("form"+id).elements.length;i++)
{ 
    if(document.forms.namedItem("form"+id).elements[i].type == "checkbox")
	  { 
       if(document.forms.namedItem("form"+id).elements[i].checked==1)
		 {
		   listapermisos[cont]=document.forms.namedItem("form"+id).elements[i].value; 
		   cont+=1;
		 // alert(document.form.elements[i].value);
		 generar=true;
		 } 
	  }
}
}
else if(document.forms.namedItem("form"+id).elements.namedItem("checkboxall"+id).checked==0)
{
listapermisos[cont]=document.forms.namedItem("form"+id).elements.namedItem("checkboxall"+id).value; 
for (i=0;i<document.forms.namedItem("form"+id).elements.length;i++)
{ 
    if(document.forms.namedItem("form"+id).elements[i].type == "checkbox")
	  { 
       if(document.forms.namedItem("form"+id).elements[i].checked==1)
		 {
		 cont+=1;
		 
		 listapermisos[cont]=document.forms.namedItem("form"+id).elements[i].value; 
		//alert(document.form.elements[i].value);
		 generar=true;
		 
		 } 
	  }
}

}
 

for(j=1;j<=listapermisos.length-1;j++)
{
//alert(document.getElementById('labelNRC'+listacursos[j]));
if(j==1){
permisos+=listapermisos[j];
permisos+="-";
//alert(id);
}
else{
permisos+=listapermisos[j];
permisos+="-";
//alert(idcurso);
}
}
 
if(generar==true){
	
	$.ajax({ 
  type: "POST",  
  cache: false,
  url: "Permisos?permitirpermiso=false&Rol="+rol,  
  data: {permisos:permisos,Rol:rol},
  success: function(msg){  
	
	

	  BuscarPermisos();
	  
	  
	  $.gritter.add({title:"PERMISOS RESTRINGIDOS",text:"Se han restringido los permisos al rol con exito"});
			
			   
			

             } 
 
         });
		   }else{
	 $('#titlemodal').html('¡Alerta!');
	 $('#bodymodal').html('Debe elegir al menos un permiso a modificar');
	 $("#cancelarmodal").hide();
	 $("#aceptarmodal").attr("data-dismiss", "modal");
   $('#myModal').modal('show');  	
	}
	
}

    
    
  function   BuscarPermisos(){
	  
    	
      //  var show =	$("#data-elements-length").val();
     //   var search =	$("#searchtable").val();
        
   	 var idrole = gup('idrole');
       
       
   	$.ajax({ 
   	    type: "GET",  
   	    cache: false,
   	    url: "Permisos?view=BuscarPermisos&Rol="+idrole,  
   	    data: "?view=BuscarPermisos&Rol"+idrole, 
   	    success: function(msg){  
   	    	
   	 
   	 	var contenido = msg.split('#%#');	    	
    
   	    	
   	    	$('div.block').unblock(); 
   	    	$("#listresultadosdashboard").html(contenido[0]);
   	    	$("#listresultadossorteos").html(contenido[1]);   	    	
   	    	$("#listresultadospoblacion").html(contenido[2]);   	    	
   	    	$("#listresultadostalonarios").html(contenido[3]);
   	    	$("#listresultadosventas").html(contenido[4]);
   	    	$("#listresultadospremios").html(contenido[5]);
   	    	$("#listresultadosreportes").html(contenido[6]);
   	    	$("#listresultadosusuarios").html(contenido[7]);
   	    	$("#listresultadosherramientas").html(contenido[8]);
   	    	
   	    	
   	    	
   	               } 
   	   
   	           });
       	
       	
       } 
       
    
    
    
    
    
    
    
    
    
    
var handlecontrollersave = function(){
    	
    	var permiso = $('#permiso').val();    	
    	var tipo = $('#tipo').val();
    	var descripcion = $('#descripcion').val();
    	
    	$('div.block').block({ 
 		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
 	        overlayCSS: {backgroundColor: '#FFF'},
 	         message: '<img src="assets/img/load-search.gif" /><br><h2> Guardando..</h2>'
       }); 
 	
    
    	
    	$.ajax({ 
    	    type: "POST",  
    	    cache: false,
    	    url: "Permisos",  
    	    data: { permiso: permiso, tipo: tipo, descripcion : descripcion},  
    	    success: function(msg){  
    	    	
    	    	 BuscarPermisos();
    	    	
    	    	 $('#formulario').parsley().reset();
    	    	 
    	    	 $('#permiso').val("");
    	    	 $("#tipo option").prop("selected", false); 	  
    	    	 $('#descripcion').val("");
        
    	    	 $('div.block').unblock();  
    	    	
    	    	if(msg.trim()==""){     	        			    
    	  	       
    	    	 
     	    	 
     	    	        $('html, body').animate({scrollTop:0}, 10);
    	    		    $("#alerta").fadeIn();
    					$("#alerta").removeClass();
    	                $("#alerta").addClass("alert alert-success");
    				//	$("#headAlerta").html("¡Correcto!");
    					$("#bodyAlerta").html("Se ha guardado con exito el permiso"); 	
    		        	
    		        	
    		        	
    				}else{
    					
    					
    					    $('html, body').animate({scrollTop:0}, 10);
    	 					$("#alerta").fadeIn();
    	 					$("#alerta").removeClass();
    	 	                $("#alerta").addClass("alert alert-error");
    	 					//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
    	 					$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se guardo el permiso, por favor intentalo nuevamente."); 
    					
    					
    					
    			   }
    				
    	    	
    	    	
    	    	
    	    	
    	    	
    	    	
    	            } 
    	           });
	
	
     }
    
    
    function Borrar(idpermiso){ 	
    	
    	

    	
   	/* $('div.block').block({ 
		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
	        overlayCSS: {backgroundColor: '#FFF'},
	         message: '<img src="assets/img/load-search.gif" /><br><h2> Borrando..</h2>'
      }); */
    	
    var deletepermiso = confirm("Seguro de eliminar el permiso.");
	
    if(deletepermiso)
    {
	$.ajax({ 
	    type: "GET", 
	    cache: false, 
	    url: "Permisos",  
	    data: "view=Borrar&idpermiso="+idpermiso,  
	    success: function(msg){  	    	
	    	
	    	$('div.block').unblock();   	 	    	
	    	 BuscarPermisos();
	    	
	        if(msg.trim()==""){ 
	        	
	        	     $('html, body').animate({scrollTop:0}, 10);
	    	   	     $("#alerta").fadeIn();
			      	 $("#alerta").removeClass();
                    $("#alerta").addClass("alert alert-success");
			      // $("#headAlerta").html("¡Correcto!");
				     $("#bodyAlerta").html("Se ha eliminado con exito el permiso"); 	
	    		
	    	   }else{
	    		   
	    		  $('html, body').animate({scrollTop:0}, 10);
					$("#alerta").fadeIn();
					$("#alerta").removeClass();
	                $("#alerta").addClass("alert alert-error");
					//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
					$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se elimino el permiso, por favor intentalo eliminar nuevamente."); 
	    		   
	    		   
	    	   }
	     //   Listar.init();
	    	   
	        	
	    	
	    	
	        } 
	   
	   });
    }
   	
   	
   	
   	
   }
    
    
    function gup(name){
    	
    	var regexS = "[\\?&]"+name+"=([^&#]*)";
    	var regex = new RegExp ( regexS );
    	var tmpURL = window.location.href;
    	var results = regex.exec( tmpURL );
    	if( results == null )
    		return"";
    	else
    		return results[1];
    }
   
    
    
    
    
    
    function seleccionarTodo(id){
    	//alert("Seleccionar Todo");
    	
    	
    	 if(document.getElementById('checkboxall'+id).checked==1)
    	   {
    	   
    	   for (i=0;i<document.forms.namedItem("form"+id).elements.length;i++){ 
    	      if(document.forms.namedItem("form"+id).elements[i].type == "checkbox"){ 
    	         document.forms.namedItem("form"+id).elements[i].checked=1 
    			 }
    			 }
    	   }
    	    else{
    		
    		for (i=0;i<document.forms.namedItem("form"+id).elements.length;i++) 
    	      if(document.forms.namedItem("form"+id).elements[i].type == "checkbox") 
    	         document.forms.namedItem("form"+id).elements[i].checked=0 
    		}
    	}





   


