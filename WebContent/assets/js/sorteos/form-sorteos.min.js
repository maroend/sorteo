/*   
Template Name: Color Admin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.1
Version: 1.5.0
Author: Sean Ngu
Website: http://www.seantheme.com/color-admin-v1.5/admin/





*/

var global = 'false';


$('#datepicker-inicio').datepicker({
	format: "mm/dd/yyyy",
    todayBtn: true
    }).on('changeDate', function(e){
         $('#finicio').val(e.format('yyyy/mm/dd'));
    	
    	//alert(e.format('dd/mm/yyyy'));
    });


$('#datepicker-fin').datepicker({
	format: "mm/dd/yyyy",
    todayBtn: true
    }).on('changeDate', function(e){
         $('#ftermino').val(e.format('yyyy/mm/dd'));
    	
    	//alert(e.format('dd/mm/yyyy'));
    });


var elem = document.querySelector('.js-switch');
var init = new Switchery(elem);

        
var handleBootstrapWizards=function(){"use strict";$("#wizard").bwizard()};


var FormWizard=function(){"use strict";return{init:function(){handleBootstrapWizards()}}}()


var guardarSorteo=function(){"use strict";return{init:function(){ 
	
	handlecontrollersave();
	
}}}()


/*var existeUsr2=function(){"use strict";return{init:function(){ 
	
	existeUsr();
	
}}}()*/




$(function(){
	
	//$("pager bwizard-buttons").bwizard("option", "backBtnText", "Back Button");
	
	//$("previous").bwizard("option",);
	
	
	 $('previous').attr('aria-disabled',true);  
	 
	 
	//$( '#parsley-id-'+id).html('<li>El usuario ya existe!!, agregue otro por favor.</li>');
	//$( '#parsley-id-'+id ).removeClass( "parsley-errors-list" ).addClass( "parsley-errors-list filled");
	
});//End function jquery




$("#wizard").bwizard({validating:function(e,t){
	
	 
    
	if(t.index==0){
		
		if(false===$('form[name="form-wizard"]').parsley().validate("wizard-step-1"))
		    {
			return false
			}
		}
	    else if(t.index==1){
				if(false===$('form[name="form-wizard"]').parsley().validate("wizard-step-2"))
				{
					return false
				}
				}
		else if(t.index==2)
				{
			
					if(false===$('form[name="form-wizard"]').parsley().validate("wizard-step-3"))
					{
						return false
						}
				
					guardarSorteo.init();
				}

	}
});


   function existeClaveSorteo(){
	
	var clave = $('#clave').val();
	
	if(clave!=""){	    	 
		
	$.ajax({ 
    type: "GET",  
    cache: false,
    url: "Sorteos.do",  
    data: "view=ExisteClave&clave="+clave,  
    success: function(msg){  
    	    	
          	
           if(msg.trim()=="existe"){     	        			    
	       
	        	var clase = $('#clave').attr('class'); 
	        	$( "#clave" ).removeClass( clase ).addClass( "form-control parsley-error" );    	        	 
	        	
	        	var id = $('#clave').attr('data-parsley-id');    	       
	        	$( '#parsley-id-'+id).html('<li>La clave ya existe!!, agregue otra porfavor.</li>');
	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list" ).addClass( "parsley-errors-list filled");
	        	
				
	        	return true; 
			}else{
				
				
				var clase = $('#clave').attr('class'); 
				var id = $('#clave').attr('data-parsley-id'); 
				$( "#clave" ).removeClass( clase ).addClass( "form-control" );
				$( '#parsley-id-'+id).html('');
	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list filled" ).addClass( "parsley-errors-list");
	        	
	        	
	        	return false; 
				
			}
		
       } 
   
      });
	
  }else{}
	
	
}




    var handlecontrollersave = function(){
    	
    	var insertar = "insertar";
    	var clave = $('#clave').val();    	
    	var sorteo = $('#sorteo').val();
    	var descripcion = $('#descripcion').val();
    	
    	var fechai = $('#finicio').val();
    	var fechat = $('#ftermino').val();
    	
    	var file = $("input[type='file']")[0].files[0];
    	
    	var fileName = file.name;
    	var fileSize = file.size;
    	
    	var imagen = fileName;
    	
    	$.ajax({ 
    	    type: "POST",  
            cache: false,
    	    url: "Sorteos.do", 
    	    data: { insertar:insertar,clave: clave, sorteo: sorteo, descripcion : descripcion, fechai:fechai, fechat:fechat, imagen:imagen},  
    	    success: function(msg){  
    	    	
    	    	uploadImage();

    	            } 
    	           });
	
     }


    function uploadImage(){
    	
    	var fd = new FormData();    
    	var file = $("input[type='file']")[0].files[0];
    	fd.append("userfile", file);
    	
    	var fileName = file.name;
    	var fileSize = file.size;
    	
    	$.ajax({
    	  url: 'Sorteos.do',
          cache: false,
    	  data: fd,
    	  processData: false,
    	  contentType: false,
    	  type: 'POST',
    	  success: function(data){
    	        //alert(data);
    	  }
    	});
    	
    }
    
    
    
    
    //Activar estado del sorteo
    var changeCheckbox = document.querySelector('.js-check-change');

    changeCheckbox.onchange = function() {
      
      
      var estado = changeCheckbox.checked 
      var activar = "activar";
      
      
      $.ajax({ 
  	    type: "POST",  
        cache: false,
  	    url: "Sorteos.do", 
  	    data: { activar:activar,estado:estado},  
  	    success: function(msg){  
  	    	
  	    	
            if(!estado){
            	$.gritter.add({title:"SORTEO DESACTIVADO",text:"El sorteo se ha desactivado para su uso"});
            }else{
  	    	$.gritter.add({title:"SORTEO ACTIVADO",text:"El sorteo se ha activado para su uso"});
            }
  	    	
  	    	
  	            } 
  	           });
    };

              
    
   
    function existeUsuario(){
    	
    	var ban = false;
    	
    	var username = $('#username').val();
    	
    	if(username!=""){	    	 
    		
    	
    	$.ajax({ 
        type: "GET",  
        cache: false,
        url: "Usuarios.do",  
        data: "view=ExisteUsuario&username="+username,  
        success: function(msg){  
        	
    	        if(msg.trim()=="existe"){     	        			    
    	       
    	        	var clase = $('#username').attr('class'); 
    	        	$( "#username" ).removeClass( clase ).addClass( "form-control parsley-error" );    	        	 
    	        	
    	        	var id = $('#username').attr('data-parsley-id');    	       
    	        	$( '#parsley-id-'+id).html('<li>El usuario ya existe!!, agregue otro porfavor.</li>');
    	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list" ).addClass( "parsley-errors-list filled");
    	        	
    	        	ban = true;
    	        	
    			}else{
    				
    				var clase = $('#username').attr('class'); 
    				var id = $('#username').attr('data-parsley-id'); 
    				$( "#username" ).removeClass( clase ).addClass( "form-control" );
    				$( '#parsley-id-'+id).html('');
    	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list filled" ).addClass( "parsley-errors-list");
    	        	
    	        	//return FALSE;
    	        	ban = false;
    				
    			}
    			
           } 
       
          });
    	
      }else{}
    	
    	return ban;
    	
    	
    }
    
    
