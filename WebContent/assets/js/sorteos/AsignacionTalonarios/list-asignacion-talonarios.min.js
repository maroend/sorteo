/*   
App Sorteo Anáhuac
Version: 1.0
Website: http://www.redanahuac.mx/app/sorteo
*/

var pag = 1;


var Listar=function(){"use strict";return{init:function(){ 
    
	
	handleListar()
	
}}}()


function onkeyup_colfield_check(e)
{
	var enterKey = 13;
	if (e.which == enterKey){
		handleListar()
	}
}

function changeShow()
{
	handleListar()
}

function getPag(page)
{
	pag = page;
	handleListar()
}

var ListarModal=function(){"use strict";return{init:function()
{
	handleListarModal();
	
}}}()


function onkeyup_colfield_checkModal(e)
{
	var enterKey = 13;
	if (e.which == enterKey){
		handleListarModal()
	}
}

function changeShowModal()
{
	handleListarModal()
}

function getPagModal(page)
{
	pag = page;
	handleListarModal()
}

var handleListarModal = function()
{
	var show =	$("#data-elements-lengthM").val();
	var search =	$("#searchtableM").val();

	$('div.block').block({ 
		css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
		overlayCSS: {backgroundColor: '#FFF'},
		message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
	}); 

	$.ajax({ 
		type: "GET",
		url: "AsignacionTalonarios",
		data: "view=BuscarModal&pg="+pag+"&show="+show+"&search="+search,
		success: function(msg){  
			$('div.block').unblock(); 
			$("#listresultados2").html(msg);
		}
	});
}  

function AsignarTalonario(confirm)
{
	
	$('#instruccionesheader').show();
	$('#instrucciones').show();
	$('#formato').hide();
	$('#formtalonarios').hide();
	$('#asignacion').hide();
	
	//bol
	$('#boletosTab').removeAttr( "class" );
	$("#bollink").attr("aria-expanded","false");	
	$('#default-tab-2').removeAttr( "tab-pane fade active in" );
	$("#default-tab-2").attr("class","tab-pane fade");	
	//tal
	$("#talonariosTab").attr("class","active");
	$("#tallink").attr("aria-expanded","true");
	$("#default-tab-1").attr("class","tab-pane fade active in");	
	
	
	
	$('#myModal').modal({
		show: true,
		backdrop: 'static'
		})
	
	
	$('#aceptarmodal').removeAttr( "onClick" );
	$("#aceptarmodal").attr("onClick","mostrarFormato()");
	$('#folio').val("");
	
	
	
	
	
}




//boletos



var ListarModalBoletos=function(){"use strict";return{init:function()
	{
		handleListarModalBoletos();
		
	}}}()


	function onkeyup_colfield_checkModalBoletos(e)
	{
		var enterKey = 13;
		if (e.which == enterKey){
			handleListarModalBoletos()
		}
	}

	function changeShowModalBoletos()
	{
		handleListarModalBoletos()
	}

	function getPagModalBoletos(page)
	{
		pag = page;
		handleListarModalBoletos()
	}

	var handleListarModalBoletos = function()
	{
		var show =	$("#data-elements-lengthMBoletos").val();
		var search =	$("#searchtableMBoletos").val();
		var idsorteo = gup('idsorteo');
		var idsector = gup('idsector');
		

		$('div.block').block({ 
			css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
			overlayCSS: {backgroundColor: '#FFF'},
			message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
		}); 

		$.ajax({ 
			type: "GET",
			url: "AsignacionTalonarios",
			data: "view=BuscarModalBoletos&pg="+pag+"&show="+show+"&search="+search+"&idsorteo="+idsorteo+"&idsector="+idsector,
			success: function(msg){  
				
				
				$('div.block').unblock(); 
				$("#listresultados3").html(msg);
			}
		});
	}  
	
	function enviarBoletos()
	{
		var arr = $("input:checked.cboletos").getCheckboxValues();
        // alert(arr);
		 if(arr.length==0){
			alert("Debe elegir un boleto");
		 }else{
			
			 $('#myModal').modal('hide');
			 $('#idboletos').val(arr);
			
			GuardarAsignacionBoletos();
			 
			
		 }
	 }
	
	
	function GuardarAsignacionBoletos ()
	{
		var idboletos = $('#idboletos').val();
		var folio = $('#folio').val();
		var idsorteo = gup('idsorteo');
		var idsector = gup('idsector');
		var accion = 'aboletos';
		
		//alert(""+(idsTalonarios==null?"null":"vacio"));

		$('div.block').block({ 
			css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
			overlayCSS: {backgroundColor: '#FFF'},
			message: '<img src="assets/img/load-search.gif" /><br><h2> Guardando..</h2>'
		}); 

		
	/*	$.ajax({ 
			type: "GET",  
			url: "AsignacionTalonarios",  
			data: "view=AsignarBoletos&idboletos="+idboletos+"&idsorteo="+idsorteo+"&idsector="+idsector+"&folio="+folio,
			success: function(msg){*/		
		
		
		$.ajax({
			type: "POST",
			url: "AsignacionTalonarios",
			data: { idboletos: idboletos, idsorteo: idsorteo, idsector: idsector,folio: folio,accion:accion},
			success: function(msg){
				
				
				$('#idboletos').val("");
				Listar.init();
				$('div.block').unblock();
				
				if(msg.trim()=="")
				{
					
					 $.gritter.add({title:"BOLETOS ASIGNADOS AL SECTOR",text:"Se ha asignado con exito los boletos!"});
				}
				else{
						$('html, body').animate({scrollTop:0}, 10);
	 					$("#alerta").fadeIn();
	 					$("#alerta").removeClass();
	 	                $("#alerta").addClass("alert alert-error");
	 					//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
	 					$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se asigno los boletos, por favor intentalo nuevamente.");     					
				}
				
			},
			error: function(msg) {
				//alert("Error");
			}
		});
	}
	
	
	/*function AsignarBoletos(confirm)
	{
		
		$('#instruccionesheader').show();
		$('#instrucciones').show();
		$('#formato').hide();
		$('#formtalonarios').hide();
		$('#asignacion').hide();
		
		$('#myModal').modal({
			show: true,
			backdrop: 'static'
			})
		
		
	//	$('#aceptarmodal').removeAttr( "onClick" );
		//$("#aceptarmodal").attr("onClick","mostrarFormato()");
	//	$('#folio').val("");
		
		
		
		
		
	}*/
	
	//fin boletos




function mostrarFormato(){
	
	$('#boletosTab').hide();
	$('#instruccionesheader').hide();
	$('#instrucciones').hide();
	$('#formato').show();
	$('#formtalonarios').hide();
	$('#asignacion').hide();
	
	$('#aceptarmodal').removeAttr( "onClick" );
	$("#aceptarmodal").attr("onClick","AsignarTalonarioboleto()");
	
	//$('#aceptarmodal').click(stopMoving);
	
}


function AsignarTalonarioboleto(){
	
    var folio = $('#folio').val();
	
    if(folio==""){
		alert("Debe ingresar el folio");
	 }else{
	$('#instruccionesheader').hide();
	$('#instrucciones').hide();
	$('#formato').hide();
	$('#formtalonarios').hide();
	$('#asignacion').show();
	
	$("#aceptarmodal").attr("onClick", "javascript:enviar();return false;");
	$('#asignacion').show();
	ListarModal.init()
	//ListarModalBoletos.init();
	
	$("#searchtableM").val('');
	
	 }
	
	
}








jQuery.fn.getCheckboxValues = function()
{
	var values = [];
	var i = 0;
	this.each(function(){
	    // guarda los valores en un array
	    values[i++] = this.id;
	});
	// devuelve un array con los checkboxes seleccionados
	return values;
}

function enviar()
{
	var arr = $("input:checked").getCheckboxValues();

	 if(arr.length==0){
		alert("Debe elegir un talonario");
	 }else{
		//alert(arr); // esto muestra un pop-up con los checkboxes seleccionados
		 $('#myModal').modal('hide');
		 $('#idsTalonarios').val(arr);
		// alert("balabla "+arr);
		 $("input:checkbox").prop('checked', false);    		 
		 
		 GuardarAsignacionTalonarios();
		 
		
	 }
 }


function GuardarAsignacionTalonarios ()
{
	var idsTalonarios = $('#idsTalonarios').val();
	var idsorteo = gup('idsorteo');
	var idsector = gup('idsector');
	var folio = $('#folio').val();
	
	//alert(""+(idsTalonarios==null?"null":"vacio"));

	$('div.block').block({ 
		css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
		overlayCSS: {backgroundColor: '#FFF'},
		message: '<img src="assets/img/load-search.gif" /><br><h2> Guardando..</h2>'
	}); 


	
	$.ajax({
		type: "POST",
		url: "AsignacionTalonarios",
		data: { idsTalonarios: idsTalonarios, idsector: idsector, idsorteo: idsorteo,folio: folio},
		success: function(msg){
			
			$('#idsTalonarios').val("");
			Listar.init();
			$('div.block').unblock();
			
			if(msg.trim()=="")
			{
				
				 $.gritter.add({title:"TALONARIOS ASIGNADOS",text:"Se ha asignado con exito el talonario!"});
			}
			else{
					$('html, body').animate({scrollTop:0}, 10);
 					$("#alerta").fadeIn();
 					$("#alerta").removeClass();
 	                $("#alerta").addClass("alert alert-error");
 					//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
 					$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se asigno el talonario, por favor intentalo nuevamente.");     					
			}
			
		},
		error: function(xhr, textStatus, error) {
			
			// alert(xhr.statusText);
			// alert(textStatus);
			// alert(error);
			
			console.log(xhr.statusText);
		      console.log(textStatus);
		      console.log(error);
			//alert("Error");
		}
	});
}

var handleListar = function(){
	var show = 10;
	var search =	$("#searchtable").val();
	var idsorteo = gup('idsorteo');
	var idsector = gup('idsector');

	$('div.block').block({ 
		css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
		overlayCSS: {backgroundColor: '#FFF'},
		message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
	});
	console.log('Hola')
	
	$.ajax({ 
		type: "GET",  
		url: "AsignacionTalonarios",  
		data: "view=Buscar&pg="+pag+"&show="+show+"&search="+search+"&idsorteo="+idsorteo+"&idsector="+idsector,
		success: function(msg){			
			
			var response = msg.split('#%#');    	
			
			
		
			$("#listresultados").html(response[0]);
			$("#numTal").html(response[1]);
			
			$('div.block').unblock(); 
			
			$("[data-toggle=tooltip]").tooltip();
			$("[data-toggle=popover]").popover();
		}
	});
} 


//--- Para eliminar

var pkTalonarioAEliminar=-1;
var folioTalonarioAEliminar=-1;
function showModalEliminarTalonario(pk, folio, sorteo, formato) {
	
	pkTalonarioAEliminar = pk;
	folioTalonarioAEliminar = folio;
	
	$('#myModal_FC5').modal({
		show: true,
		backdrop: 'static'
		})
	
}

function eliminarTalonario() {
	if(pkTalonarioAEliminar != -1) {
		$.ajax({ 
			type: "POST",  
			url: "AsignacionTalonarios",
			data: { pk: pkTalonarioAEliminar, folio: folioTalonarioAEliminar, accion:'eliminatalonario'},
	
			success: function(msg){
				
				 $.gritter.add({title:"TALONARIOS Y BOLETOS DEVUELTOS",text:"Se ha devuelto con exito los talonarios y boletos!"});
				
				handleListar();
				
				$('#myModal_FC5').modal('hide');	
			}
		});
	}
}





 function gup(name){
	
	var regexS = "[\\?&]"+name+"=([^&#]*)";
	var regex = new RegExp ( regexS );
	var tmpURL = window.location.href;
	var results = regex.exec( tmpURL );
	if( results == null )
		return"";
	else
		return results[1];
}



////////////////VENTA DE BOLETOS//////////
    

function ShowDetalleBoleto(idsorteo,pkboleto,boleto,pktalonario,talonario,abono,monto,pksector,pknicho,pkcolaborador,edoventa){
	
	if(edoventa.trim()=="R"){
	
	  $('#boletov').hide();	
	  $('#boletoreporte').hide();	
	}
	else{ 
	  $('#boletov').css("display","block"); 
	   $('#boletoreporte').css("display","block"); 
	}
	
	
	
	$('#modalDetalleBoleto').modal({
		show : true,
		backdrop : 'static'
	});
	
	CancelarventaBoleto();
	BuscarComprador(idsorteo,pkboleto,boleto,pktalonario,talonario,abono,monto,pksector,pknicho,pkcolaborador);
	
}



function AbonarBoleto(){
	
	$('#boleto-extravio').hide();
	$('#boleto-info').hide();
	$('#boleto-venta').show();
	
}


function CancelarventaBoleto(){
	
	$('#boleto-extravio').hide();
	$('#boleto-venta').hide();
	$('#boleto-info').show();
	
	
}


function ReportedeExtravioBoleto(){
	
	$('#boleto-info').hide();
	$('#boleto-venta').hide();
	$('#boleto-extravio').show();
	
}

/****************REGISTRO DE VENTA BOLETOS******************/

function BuscarIncidenciaBoleto(idsorteo,boleto,talonario){
	
	var idsorteo =	idsorteo;
    var boleto =	boleto;
    var talonario = talonario;
    
    
    $.ajax({ 
	    type: "GET",  
	    url: "BoletosSorteo",  
	    data: "view=GetIncidenciaBoleto&sorteo="+idsorteo+"&boleto="+boleto+"&talonario="+talonario,  
	    success: function(msg){  
	    	
	    
	    	
	    	if(msg.trim() =="NULL"){
	    		
	    		$('#incidencia').val('N');
	    		$('#formatofc8').val('');
	    		$('#folioactamp').val('');
	    		$('#detallesincidencia').val('');
	    		$('#divincidencia').hide();
	    		
	    	}else{
	    		
	    		var res = msg.split("|");
	    		var incidencia ="";
	    	
	    		
	    		
	    		if(res[2].trim()=="E"){ incidencia='<span class="label label-danger">EXTRAVIO DE BOLETO</span>'; }
	    		if(res[2].trim()=="R"){ incidencia='<span class="label label-inverse">ROBO DE BOLETO</span>'; }
	    		
	    		$('#divincidencia').show();
	    		$('#tincidencia').html(incidencia);
	    		$('#tformatoincidencia').html(res[1]);
	    		$('#tfoliomp').html(res[3]);
	    		$('#tdetallesincidencia').html(res[4]);
	    		
	    		
	    		
	    		
	    		$('#incidencia').val(res[2].trim());
	    		$('#formatofc8').val(res[1]);
	    		$('#folioactamp').val(res[3]);
	    		$('#detallesincidencia').val(res[4]);
	    		
	    		
	    		 
	    	}
	    	
	    	/*
	    	$('div.block').unblock(); 
	    	$("#listresultados").html(msg);
	    	*/
	    	
	               } 
	   
	           });
    
    
}

function BuscarComprador(idsorteo,pkboleto,boleto,pktalonario,talonario,abono,monto,pksector,pknicho,pkcolaborador){
	
	var idsorteo =	idsorteo;
    var boleto =	boleto;
    var talonario = talonario;
    var abono = abono;
    var monto = monto;
    
    var urlseguimientoboleto = "SeguimientoBoletos?idsorteo="+idsorteo+"&idboleto="+pkboleto+"&menu=2";
    $("#linkseguimientoboleto").attr("href", urlseguimientoboleto);
    
    $('#divincidencia').hide();
    $('#sorteo').val(idsorteo);
    $('#pkboleto').val(pkboleto);
    $('#pktalonario').val(pktalonario);
    $('#boleto').val(boleto);
    $('#talonario').val(talonario);
    $('#costo').val(monto);
    
    $('#pksector').val(pksector);
    $('#pknicho').val(pknicho);
    $('#pkcolaborador').val(pkcolaborador);
    
    $('#pkabono').val(abono);
    $('#pkcosto').val(monto);
    
    $('#boletofolio').html(boleto);
    $('#talonariofolio').html(talonario);
    $('#boletofolioabono').html(boleto);
    $('#talonariofolioabono').html(talonario);
    
    $('#incidenciaboletofolio').html(boleto);
    $('#incidenciatalonariofolio').html(talonario);
    
    
    $('#montoboleto').html("$"+monto);
    $('#abonoboleto').html("$"+abono);
    
    
    /*
	  $('div.block').block({ 
		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
	        overlayCSS: {backgroundColor: '#FFF'},
	         message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
     }); */
	
   
	$.ajax({ 
	    type: "GET",  
	    url: "BoletosSorteo",  
	    data: "view=GetComprador&sorteo="+idsorteo+"&boleto="+boleto+"&talonario="+talonario,  
	    success: function(msg){  
	    	
	    	//alert(msg);
	    	
	    	if(msg.trim() =="NULL"){
	    		
	    		$( "#estatusboleto" ).removeClass().addClass( "badge badge-inverse badge-square" ); $( "#estatusboleto" ).html('NO VENDIDO');
	    		$('#comprador').html('----------------------');
	    		$('#telefonofijo').html('---------');
	    		$('#telefonomovil').html('---------');
	    		$('#correo').html('---------');
	    		
	    		$('#calle').html('---------');
	    		$('#numero').html('----');
	    		
	    		$('#colonia').html('---------');
	    		$('#estado').html('---------');
	    		$('#municipio').html('---------');
	    		
	    		$('#iabono').val("0");
	    	     $('#inombre').val("");
	    	     $('#iapellidos').val("");
	    	     $('#itelefonofijo').val("");
	    	     $('#itelefonomovil').val("");
	    	     $('#icorreo').val("");
	    	     $('#icalle').val("");
	    	     $('#inumero').val("");
	    	     $('#icolonia').val("");
	    	     $('#iestado').val("");
	    	     $('#imunicipio').val("");
	    		
	    	}else{
	    		
	    		var res = msg.split("|");	
	    		
	    		
	    		if(parseInt(abono)<parseInt(monto)){ $( "#estatusboleto" ).removeClass().addClass( "badge badge-default badge-square" ); $( "#estatusboleto" ).html('VENDIDO (P)');  }
	    		if(parseInt(abono)==parseInt(monto)){ $( "#estatusboleto" ).removeClass().addClass( "badge badge-success badge-square" ); $( "#estatusboleto" ).html('VENDIDO'); }
	    		if(parseInt(abono)==0){ $( "#estatusboleto" ).removeClass().addClass( "badge badge-inverse badge-square" ); $( "#estatusboleto" ).html('NO VENDIDO'); }
	    		
	    		$('#abonoboleto').html("$"+res[1]);
	    		$('#comprador').html(res[2]+" "+res[3]);
	    		$('#telefonofijo').html(res[4]);
	    		$('#telefonomovil').html(res[5]);
	    		$('#correo').html(res[6]);
	    		
	    		$('#calle').html(res[7]);
	    		$('#numero').html(res[8]);
	    		
	    		$('#colonia').html(res[9]);
	    		$('#estado').html(res[10]);
	    		$('#municipio').html(res[11]);
	    		
	    		
	    		 $('#iabono').val(res[1]);
	    	     $('#inombre').val(res[2]);
	    	     $('#iapellidos').val(res[3]);
	    	     $('#itelefonofijo').val(res[4]);
	    	     $('#itelefonomovil').val(res[5]);
	    	     $('#icorreo').val(res[6]);
	    	     $('#icalle').val(res[7]);
	    	     $('#inumero').val(res[8]);
	    	     $('#icolonia').val(res[9]);
	    	     $('#iestado').val(res[10]);
	    	     $('#imunicipio').val(res[11]);
	    		
	    		 
	    	}
	    	
	    	//BUSCAMOS INCIDENCIAS DEL BOLETO A MOSTRAR
	    	BuscarIncidenciaBoleto(idsorteo,boleto,talonario);
	    	
	    	/*
	    	$('div.block').unblock(); 
	    	$("#listresultados").html(msg);
	    	*/
	    	
	               } 
	   
	           });
	
	
}

function InsertarVentaComprador(){
	
	var idsorteo = $('#sorteo').val();
    var boleto = $('#boleto').val();
    var talonario = $('#talonario').val();
    var costo = $('#costo').val();
    var operacion = "InsertComprador";
    
    var pktalonario = $('#pktalonario').val();
    var pkboleto = $('#pkboleto').val();
    var pksector = $('#pksector').val();
    var pknicho = $('#pknicho').val();
    var pkcolaborador = $('#pkcolaborador').val();
    
    
        var abono = $('#iabono').val();
    	var nombre = $('#inombre').val();
    	var apellidos =$('#iapellidos').val();
    	var telefonofijo =$('#itelefonofijo').val();
    	var telefonomovil = $('#itelefonomovil').val();
    	var correo = $('#icorreo').val();
    	var calle = $('#icalle').val();
    	var numero = $('#inumero').val();
    	var colonia = $('#icolonia').val();
    	var estado = $('#iestado').val();
    	var municipio = $('#imunicipio').val();
    	
    	var estadoboleto = "";
    	
	/*
	  $('div.block').block({ 
		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
	        overlayCSS: {backgroundColor: '#FFF'},
	         message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
     }); */
	
    	if(abono!="" && abono!=0 && nombre!="" && apellidos!= "" && telefonofijo!="" && telefonomovil!="" && correo!="" && calle!="" && numero!="" && colonia!="" && estado!="" && municipio!=""){
   
    		  if(parseInt(abono)<=parseInt(costo)){
    		  
	$.ajax({ 
	    type: "POST",  
	    url: "BoletosSorteo",  
	    data: { operacion: operacion, sorteo:idsorteo,talonario:talonario, boleto:boleto,costo:costo,abono:abono,nombre:nombre,apellidos:apellidos,telefonofijo:telefonofijo,telefonomovil:telefonomovil,correo:correo,calle:calle,numero:numero,colonia:colonia,estado:estado,municipio:municipio,pkboleto:pkboleto,pksector:pksector,pknicho:pknicho,pkcolaborador:pkcolaborador,pktalonario:pktalonario},
	    success: function(msg){  
	    	
	    	//alert(msg);
	    	/*
	    	$('div.block').unblock(); 
	    	$("#listresultados").html(msg);
	    	*/
	    	
	    	$('#comprador').html(nombre+" "+apellidos);
    		$('#telefonofijo').html(telefonofijo);
    		$('#telefonomovil').html(telefonomovil);
    		$('#correo').html(correo);
    		
    		$('#calle').html(calle);
    		$('#numero').html(numero);
    		
    		$('#colonia').html(colonia);
    		$('#estado').html(estado);
    		$('#municipio').html(municipio);
    		$('#pkabono').val(abono);
    		
    		
    		if(parseInt(abono)<parseInt(costo)){ $( "#estatusboleto" ).removeClass().addClass( "badge badge-default badge-square" ); $( "#estatusboleto" ).html('VENDIDO (P)');  }
    		if(parseInt(abono)==parseInt(costo)){ $( "#estatusboleto" ).removeClass().addClass( "badge badge-success badge-square" ); $( "#estatusboleto" ).html('VENDIDO'); }
	    	
	    	
	    	$('#abonoboleto').html("$"+abono);
	    	$.gritter.add({title:"Venta de Boleto",text:"Se ha registrado la venta del boleto"});
	    	CancelarventaBoleto();
	    	Listar.init();           
	    
	    } 
	   
	           });
    		  }else{
    			  
    			  alert("Debe ingresar una cantidad menor o igual al costo del boleto: $"+costo);
    		  }
	
    	}else{
    		
    		if(abono==0){
    			//SE ELIMINA LA VENTA DEL BOLETO
    			if(confirm("Se eliminara la venta del boleto?")){
    			operacion = "eliminarVenta";
    			
    			$.ajax({ 
    			    type: "POST",  
    			    url: "BoletosSorteo",  
    			    data: { operacion: operacion, sorteo:idsorteo,talonario:talonario, boleto:boleto,costo:costo,pkboleto:pkboleto,pksector:pksector,pknicho:pknicho,pkcolaborador:pkcolaborador,pktalonario:pktalonario},
    			    success: function(msg){  
    			    	
    			    	//alert(msg);
    			    	/*
    			    	$('div.block').unblock(); 
    			    	$("#listresultados").html(msg);
    			    	*/
    			    	
    			    	$('#pkabono').val('0');
    			    	$( "#estatusboleto" ).removeClass().addClass( "badge badge-inverse badge-square" ); $( "#estatusboleto" ).html('NO VENDIDO');
    			    	$('#abonoboleto').html("$0.00");
    			    	$('#comprador').html('----------------------');
    		    		$('#telefonofijo').html('---------');
    		    		$('#telefonomovil').html('---------');
    		    		$('#correo').html('---------');
    		    		
    		    		$('#calle').html('---------');
    		    		$('#numero').html('----');
    		    		
    		    		$('#colonia').html('---------');
    		    		$('#estado').html('---------');
    		    		$('#municipio').html('---------');
    		    		
    		    		$('#iabono').val("0");
    		    	     $('#inombre').val("");
    		    	     $('#iapellidos').val("");
    		    	     $('#itelefonofijo').val("");
    		    	     $('#itelefonomovil').val("");
    		    	     $('#icorreo').val("");
    		    	     $('#icalle').val("");
    		    	     $('#inumero').val("");
    		    	     $('#icolonia').val("");
    		    	     $('#iestado').val("");
    		    	     $('#imunicipio').val("");
    			    	
    			    	$.gritter.add({title:"Venta de Boleto",text:"Se ha ELIMINADO la venta del boleto"});
    			    	CancelarventaBoleto();
    			    	Listar.init();
    			               } 
    			   
    			           });
    			}
    			
    		}else{
    			alert("Debes de llenar todos los campos.");	
    		}
    		
    	}
	
}

function RegistrarIncidenciaBoleto(){
	
	var idsorteo = $('#sorteo').val();
    var boleto = $('#boleto').val();
    var talonario = $('#talonario').val();
    
    var pkboleto = $('#pkboleto').val();
    var pksector = $('#pksector').val();
    var pknicho = $('#pknicho').val();
    var pkcolaborador = $('#pkcolaborador').val();
    
    var abono = $('#pkabono').val();
    var costo = $('#pkcosto').val();
    
    
    var deleteincicencia = false;
   
        var operacion = "InsertIncidencia";
        var incidencia = $('#incidencia').val();
        
        if(incidencia.trim()=="N"){
        	operacion = "EliminarIncidencia";
        	
        	if(confirm("Desea eliminar la incidencia?")){
        		deleteincicencia =  true;
        	}
        }
        
    	var formatofc8 = $('#formatofc8').val();
    	var folioactamp =$('#folioactamp').val();
    	var detallesincidencia = $('#detallesincidencia').val();
    	
    	
    	
         if((deleteincicencia==false && incidencia.trim()!="N") | (deleteincicencia==true && incidencia.trim()=="N") ){ 
    	       
        	 
    	$.ajax({ 
    	    type: "POST",  
    	    url: "BoletosSorteo",  
    	    data: { operacion: operacion, sorteo:idsorteo,talonario:talonario, boleto:boleto,incidencia:incidencia,formatofc8:formatofc8,folioactamp:folioactamp,detallesincidencia:detallesincidencia,pksector:pksector,pknicho:pknicho,pkcolaborador:pkcolaborador,pkboleto:pkboleto,abono:abono,costo:costo},
    	    success: function(msg){  
    	    	
    	    	/*
    	    	$('div.block').unblock(); 
    	    	$("#listresultados").html(msg);
    	    	*/
    	    	if(deleteincicencia!=false){
    	    		$('#formatofc8').val('');
    	    		$('#folioactamp').val('');
    	    		$('#detallesincidencia').val('');
    	    		$('#divincidencia').hide();
    	    		
    	    		$.gritter.add({title:"ELIMINADA Incidencia de Boleto",text:"Se ha eliminada la incidencia del BOLETO"});
    	    	}else{
    	    		
    	    		
    	    		if(incidencia.trim()=="E"){ incidencia='<span class="label label-danger">EXTRAVIO DE BOLETO</span>'; }
    	    		if(incidencia.trim()=="R"){ incidencia='<span class="label label-inverse">ROBO DE BOLETO</span>'; }
    	    		
    	    		$('#tincidencia').html(incidencia);
    	    		$('#tformatoincidencia').html(formatofc8);
    	    		$('#tfoliomp').html(folioactamp);
    	    		$('#tdetallesincidencia').html(detallesincidencia);
    	    		$('#divincidencia').show();
    	    		
    	    		$.gritter.add({title:"Incidencia de Boleto",text:"Se ha registrado una incidencia de BOLETO"});
    	    	}
    	    		
    	    	CancelarventaBoleto();
    	               } 
    	   
    	           });
         }
        
	
}
  

/**************END REGISTRO DE VENTA DE BOLETOS***************/


/**************END REGISTRO DE VENTA DE BOLETOS***************/



// --- Para empieza retornar y devolver


function mensajeRetornarFC4() {

 $.gritter.add({title:"BOLETOS Retornados FC4:",text:"El Talonario no esta TOTALMENTE vendido!"});

}

function mensajeRetornarDigitalTalFC4() {

	 $.gritter.add({title:"BOLETOS Retornados FC4:",text:"El Talonario es Electronico y No Retorna Talonarios!"});

}

function mensajeDevolverF5() {

 $.gritter.add({title:"BOLETOS Devueltos FC5:",text:"El Talonario no esta TOTALMENTE NO vendido!"});

}


function mensajeDevolverTalDigF5() {

	 $.gritter.add({title:"BOLETOS Devueltos FC5:",text:"El Talonario es Electronico y tiene algun(os) boleto(s) con comprador y folio digital!"});

}




function mensajeDevolverF5B() {

//DevolverTalonarioFc5();
//$("#foliofc4").val("-1")

 $.gritter.add({title:"BOLETOS Devueltos FC5B:",text:"El Talonario esta TOTALMENTE vendido o TOTALMENTE NO vendido!"});

}

function mensajeCargaNF5() {

 $.gritter.add({title:"DEVOLVER TALONARIO AL SECTOR",text:"El Talonario existe en Nichos. Debe Devolver el Talonario al Sector primero!"});

}

function mensajeCargaNF5B() {

	$.gritter.add({title:"DEVOLVER BOLETOS NO VENDIDOS AL SECTOR",text:"Existen Boletos No vendidos en Nichos!. Debe Devolver los Boletos No Vendidos en Nichos al Sector primero!"});

}


var pkTalonarioAEliminar=-1;
var folioTalonarioAEliminar=-1;
         
function showModalRetornoTalonarioFC4(pk, folio, sorteo, formato) {
	
	pkTalonarioAEliminar = pk;
	folioTalonarioAEliminar = folio;
	$("#foliofc4").val("");
	
	$('#myModal_FC4').modal({
		show: true,
		backdrop: 'static'
		})
	
}

	

function RetornoTalonariosFC4() {
	
		var foliofc4 =	$("#foliofc4").val();
		
	if(pkTalonarioAEliminar != -1 && foliofc4 != "") {
		
	
		
		$.ajax({ 
			type: "POST",  
			url: "AsignacionTalonarios",
			data: { pk: pkTalonarioAEliminar, folio: folioTalonarioAEliminar, foliofc4: foliofc4, accion:'retornotalonariosfc4'},
	
			success: function(msg){
			
			//alert(msg);
			
			
			/* if(msg.trim()=="TRUE"){
				
				$.gritter.add({title:"BOLETOS Retornados FC4:",text:"El Talonario no esta TOTALMENTE vendido!"});
				
				
				
			}
			else { 
				
				  $.gritter.add({title:"BOLETOS RETORNADOS",text:"Se ha Retornados con &Eacute;xito los Boletos!"});
				
				}	*/		
				
				 
				handleListar();
				
				$('#myModal_FC4').modal('hide');
				
			
			
			}
		});
		
	}else{
	    alert("Debe ingresar el Folio FC4, gracias!");
	  
	}
}




var pkTalonarioADevolver=-1;
var folioTalonarioADevolver=-1;


function showModalDevolverTalonarioFc5(pk, folio, sorteo, formato) {
	
	pkTalonarioADevolver = pk;
	folioTalonarioADevolver = folio;
	
	$('#myModal_FC5').modal({
		show: true,
		backdrop: 'static'
		})
	
}

function DevolverTalonarioFc5() {



    var foliofc5 =	$("#foliofc5").val();
     
	if(pkTalonarioADevolver != -1 && foliofc5 != "") {
	
	
	
		$.ajax({ 
			type: "POST",  
			url: "AsignacionTalonarios",
			data: { pk: pkTalonarioADevolver, folio: folioTalonarioADevolver,  foliofc5: foliofc5, accion:'devolvertalonariofc5'},
	
			success: function(msg){	

			
			   /* if(msg.trim()=="NTNOVENDIDOS"){
				
				$.gritter.add({title:"BOLETOS Devueltos FC5:",text:"El Talonario no esta TOTALMENTE NO vendido!"});
				
				}
				else if(msg.trim()=="EXISTECNICHOS"){
				
				 $.gritter.add({title:"DEVOLVER TALONARIO AL SECTOR",text:"El Talonario existe en Nichos. Debe Devolver el Talonario al Sector primero!"});
				
				}
				
				else{
				$.gritter.add({title:"TALONARIOS Y BOLETOS DEVUELTOS",text:"Se ha Devuelto con &Eacute;xito los Talonarios y Boletos!"});
				 
				
				}	*/
				
                $("#searchtable").val("");				
				handleListar();				
					    		
				
				$('#myModal_FC5').modal('hide');	
				
				
			}
		});
	}else{
	    alert("Debe ingresar el Folio FC5, gracias!");
	  
	}
}

pkTalonarioADevolver5B = -1;
folioTalonarioADevolver5B = -1;

function ModalDevolTalonarioFc5b(pk, folio, sorteo, formato) {
	
	pkTalonarioADevolver5B = pk;
	folioTalonarioADevolver5B = folio;
	
	$('#myModal_FC5B').modal({
		show: true,
		backdrop: 'static'
		})
	
}

function DevolverTalonarioFc5B() {

   var foliofc5B =	$("#foliofc5B").val();
   
	if(pkTalonarioADevolver5B != -1  && foliofc5B != "") {
	
	
	
	
		$.ajax({ 
			type: "POST",  
			url: "AsignacionTalonarios",
			data: { pk: pkTalonarioADevolver5B, folio: folioTalonarioADevolver5B,  foliofc5B: foliofc5B, accion:'devolvertalonariofc5B'},
	
			success: function(msg){		

	    		/*if(msg.trim()=="NOPARCIALES"){
				
				$.gritter.add({title:"BOLETOS Devueltos FC5B:",text:"El Talonario esta TOTALMENTE vendido o TOTALMENTE NO vendido!"});
				
				}
				else if(msg.trim()=="EXISTECNICHOS"){
				
				$.gritter.add({title:"DEVOLVER BOLETOS NO VENDIDOS AL SECTOR",text:"Existen Boletos No vendidos en Nichos!. Debe Devolver los Boletos No Vendidos en Nichos al Sector primero!"});
				
				}
				
				else{
				 $.gritter.add({title:"BOLETOS PARCIALMENTE VENDIDOS",text:"Se ha Devuelto con &Eacute;xito los Boletos!"});
				 
				
				}*/				
				handleListar();	
				$('#myModal_FC5B').modal('hide');
                			
				
				
			}
		});
	}else{
	    alert("Debe ingresar el Folio FC5B, gracias!");
	  
	}
}


// --- Termina empieza retornar y devolver
