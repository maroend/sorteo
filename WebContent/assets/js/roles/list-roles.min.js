/*   
App Sorteo Anáhuac
Version: 1.0
Author: Jose Carlos Ruiz Garcia
Website: http://www.redanahuac.mx/app/sorteo
*/


var pag = 1;

var ListarRoles=function(){"use strict";return{init:function(){ 
	
	handleListarRoles()
	
}}}()



function onkeyup_colfield_check(e){
    var enterKey = 13;
        if (e.which == enterKey){
        	handleListarRoles()
        }
}

    function changeShow(){
    	
    	handleListarRoles()
    }

    function getPag(page){
	
	pag = page;
	handleListarRoles()
    }
    
    
    function Editar(idrole){ 
   	   
    	$("#aceptarmodal").attr("onClick", "javascript:enviar();return false;");    
        $('#myModal').modal('show');
        BuscarRole(idrole);
      
        
    	
    } 
    
    
  function BuscarRole(idrole) {
    	
	  $('#formulario').parsley().reset();
    
    	
    	if(idrole!=""){
    	 
    		
    		/*$.blockUI({ css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
    	            overlayCSS: {backgroundColor: '#FFF'},
                     message: '<img src="skins/default/images/spinner-md.gif" /><br><h3> Espere un momento..</h3>'
                     });*/
                     
    		
    		
    	$.ajax({ 
        type: "GET",  
        cache: false,
        url: "Roles.do",  
        data: "view=BuscarRole&idrole="+idrole,  
        success: function(msg){  
        	
        	 
        	var response = msg.split('#%#');
        	
        	
        	$('#role').val(response[0]);
        	$('#descripcion').val(response[1]);        	
        	$('#idrole').val(response[2]);
        	
        	
        
        	
        
                   } 
       
               });
    		   }else{
    		   	
    			
    			
    		   }
    	
    }

    
  
  
  
  
    
  function enviar(){
    	
    	
	  
	    var idrole = $('#idrole').val();
    	var role = $('#role').val();
    	var descripcion = $('#descripcion').val();
    	
    	   
    	
  if( $('#formulario').parsley().validate() ){    	
    	
    	
    	
    	$.blockUI({ css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
            overlayCSS: {backgroundColor: '#FFF'},
             message: '<img src="skins/default/images/spinner-md.gif" /><br><h3> Espere un momento..</h3>'
             });
    
    	
    	/*$.ajax({ 
    	    type: "POST",  
    	    url: "Usuarios.do",  
    	    data: { idusuario: idusuario, username: username, password: password},  
    	    success: function(msg){  */
    	
    	$.ajax({ 
            type: "GET", 
            cache: false, 
            url: "Roles.do",  
            data: "view=Editar&idrole="+idrole+"&role="+role+"&descripcion="+descripcion,  
            success: function(msg){  
    	          
            	 $('#idrole').val('');
                 $('#role').val('');
                 $('#descripcion').val('');
                 
            	  $('#myModal').modal('hide');
    	
    	        $.unblockUI();
    	        
    	    	if(msg.trim()==""){ 
 	    		    
	        	     $('html, body').animate({scrollTop:0}, 10);
	    	    	 $("#alerta").fadeIn();
			      	 $("#alerta").removeClass();
                     $("#alerta").addClass("alert alert-success");
			      // $("#headAlerta").html("¡Correcto!");
				     $("#bodyAlerta").html("Se ha editado con exito el rol");
    	    		
				     ListarRoles.init();
    	    		// setTimeout("window.location.href = 'Usuarios.do' ",1000);
	    		
	    	   }else{
	    		  
	    		   
	    		   $('html, body').animate({scrollTop:0}, 10);
					$("#alerta").fadeIn();
					$("#alerta").removeClass();
	                $("#alerta").addClass("alert alert-error");
					//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
					$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se edito el rol, por favor intentalo editar nuevamente."); 
	    		   
	    		   
	    	   }
	    	   
   				
    			
    	            } 
    	           });
    	
    	
        }
         return false;
    	
	
	
     }



    
    
    
    



    var handleListarRoles = function(){
    	
    	
     var show =	$("#data-elements-length").val();
     var search =	$("#searchtable").val();
     
     if(search!=""){ pag=1;}
	
	  $('div.block').block({ 
		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
	        overlayCSS: {backgroundColor: '#FFF'},
	         message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
      }); 
	
    
	$.ajax({ 
	    type: "GET",  
      cache: false,
	    url: "Roles.do",  
	    data: "view=Buscar&pg="+pag+"&show="+show+"&search="+search,  
	    success: function(msg){  
	    	
	    	
	    	$('div.block').unblock(); 
	    	$("#listresultados").html(msg);
	    	
	    	
	               } 
	   
	           });
    	
    	
    } 
    
    
    
    function Borrar(idrole){ 	
    	
    	
    var confirm=window.confirm("Esta seguro de Borrar el Role?");
    if (confirm==true) {	
    	
    	
    	
      	 $('div.block').block({ 
   		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
   	        overlayCSS: {backgroundColor: '#FFF'},
   	         message: '<img src="assets/img/load-search.gif" /><br><h2> Borrando..</h2>'
         }); 
   	
       
   	$.ajax({ 
   	    type: "GET",  
        cache: false,
   	    url: "Roles.do",  
   	    data: "view=Borrar&idrole="+idrole,  
   	    success: function(msg){  	    	
   	    	
   	    	$('div.block').unblock();   	 	    	
   	    	
   	    	
   	     if(msg.trim()!=""){ 
         	
         	
         	if(msg.trim()=="-1"){         		
         		
         		        		
         		var r = window.confirm("El Role no se puede eliminar, por que esta asignado a otras tablas!\nDeseas Eliminarlo de todas maneras(Se eliminaran en las tablas donde este asignado)?");
         		
         		if (r == true) {        		
         			
         			Borrar_DependenciasRole(idrole);      			
         			
         		    
         		} else {}        	
 			  
 	
         		
         	}else{
         		

        	     $('html, body').animate({scrollTop:0}, 10);
    	   	     $("#alerta").fadeIn();
 		         $("#alerta").removeClass();
                 $("#alerta").addClass("alert alert-success");
 		         // $("#headAlerta").html("¡Correcto!");
 			     $("#bodyAlerta").html("Se ha eliminado con exito el role"); 	
         		
         		
         		
         	}
         	
         	
     		
     	   }
         else{
     		   
     		  $('html, body').animate({scrollTop:0}, 10);
 				$("#alerta").fadeIn();
 				$("#alerta").removeClass();
                 $("#alerta").addClass("alert alert-error");
 				//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
 				$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se elimino el role, por favor intentalo eliminar nuevamente."); 
     		   
     		   
     	   }
   	        
   	        ListarRoles.init();
   	    	   
   	        	
   	    	
   	    	
   	        } 
   	   
   	   });
      	
      	
   	
    }
      	
      	
  }
    
    
    function Borrar_DependenciasRole(idrole){ 
    	
    	
    	
   	 $('div.block').block({ 
   		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
   	        overlayCSS: {backgroundColor: '#FFF'},
   	         message: '<img src="assets/img/load-search.gif" /><br><h2> Borrando..</h2>'
   	      }); 

   		
   		 
   			$.ajax({ 
   	            type: "GET", 
   	            async:false, 
   	            cache: false, 
   	            url: "Roles.do",  
   	            data: "view=BorrarDependencias&idrole="+idrole,  
   	            success: function(msg){  
   	            	
   	            	//alert(msg);
   	    	
   	    	$('div.block').unblock();   	 	    	
   	    	
   	    	
   	          if(msg.trim()==""){ 
   	        	  
   	        	  
   	        	 $('html, body').animate({scrollTop:0}, 10);
   	    	   	 $("#alerta").fadeIn();
   	 		     $("#alerta").removeClass();
   	             $("#alerta").addClass("alert alert-success");
   	 		      // $("#headAlerta").html("¡Correcto!");
   	 			 $("#bodyAlerta").html("Se ha eliminado con exito el role"); 	
   	        	  
   	        	  
   	        	  
   	          }else{
   	        	  
   	        	  
   	        	  $('html, body').animate({scrollTop:0}, 10);
   					$("#alerta").fadeIn();
   					$("#alerta").removeClass();
   	                $("#alerta").addClass("alert alert-error");
   					//$("#headAlerta").html("<font size=\"3\">¡Ups! ha ocurrido un Error</font>");
   					$("#bodyAlerta").html("<strong>No te alarmes</strong>!! al parecer no se elimino el role, por favor intentalo eliminar nuevamente."); 
   	    		   
   	        	  
   	        	  
   	        	  
   	        	  
   	          }          
   	          
   	          
   	          
   	          
   	        }
   	
   	    });
   	
   	
   	
   	
   }


   


