/*   
Template Name: Color Admin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.1
Version: 1.5.0
Author: Sean Ngu
Website: http://www.seantheme.com/color-admin-v1.5/admin/
*/
var pag = 1;
var global = 'false';



var handleBootstrapWizards=function(){"use strict";$("#wizard").bwizard()};


var FormWizard=function(){"use strict";return{init:function(){handleBootstrapWizards()}}}()


var guardarUsuario=function(){"use strict";return{init:function(){ 
	
	handlecontrollersave();
	
}}}()


/*var existeUsr2=function(){"use strict";return{init:function(){ 
	
	existeUsr();
	
}}}()*/




$(function(){
	
	//$("pager bwizard-buttons").bwizard("option", "backBtnText", "Back Button");
	
	//$("previous").bwizard("option",);
	
	
	 $('previous').attr('aria-disabled',true);  
	 
	 
	//$( '#parsley-id-'+id).html('<li>El usuario ya existe!!, agregue otro por favor.</li>');
	//$( '#parsley-id-'+id ).removeClass( "parsley-errors-list" ).addClass( "parsley-errors-list filled");
	
});//End function jquery




$("#wizard").bwizard({validating:function(e,t){
	
	 
    
	
	
	if(t.index==0){
		
		if(false===$('form[name="form-wizard"]').parsley().validate("wizard-step-1"))
		    {
			return false
			}
		}
	    else if(t.index==1){
				if(false===$('form[name="form-wizard"]').parsley().validate("wizard-step-2"))
				{
					return false
				}
				}
		else if(t.index==2)
				{
					if(false===$('form[name="form-wizard"]').parsley().validate("wizard-step-3"))
					{
						return false
						}
					}
	
		else if(t.index==3)
		{
						
			
			if( $('#username').val()== ""){
				
				var clase = $('#username').attr('class'); 
				var id = $('#username').attr('data-parsley-id'); 
				$( "#username" ).removeClass( clase ).addClass( "form-control" );
				$( '#parsley-id-'+id).html('');
	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list filled" ).addClass( "parsley-errors-list");
	        	
				
				
			}
			
				
			
			
			if(false===$('form[name="form-wizard"]').parsley().validate("wizard-step-4"))
			{			
				
				    return false
			}else{
					
					
					//if( existeUsuario2() ){
						
					//	alert('entro');
					//	return false;
				     
				 //   }else{
				    	
				   // 	alert('no');
					
					guardarUsuario.init();
					
					if(global.trim() == 'true'){	
					
						return false;
						
						
					}
					
					//alert('no');
					
					
					
			 }
			
			
		     
			
			
		}
	}
});


   function existeUsuario2(){
	
	//
	
	var username = $('#username').val();
	
	if(username!=""){	    	 
		
		
		
		
	//$("#preloader").html('<img src="assets/img/load-search.gif" />');
		
	
	$.ajax({ 
    type: "GET",  
    cache: false,
    url: "Usuarios.do",  
    data: "view=ExisteUsuario&username="+username,  
    success: function(msg){  
    	
    	
      	
	        if(msg.trim()=="existe"){     	        			    
	       
	        	//$( "#username" ).addClass( "form-control parsley-error" );
	        	
	        	var clase = $('#username').attr('class'); 
	        	$( "#username" ).removeClass( clase ).addClass( "form-control parsley-error" );    	        	 
	        	
	        	
	        	var id = $('#username').attr('data-parsley-id');    	       
	        	$( '#parsley-id-'+id).html('<li>El usuario ya existe!!, agregue otro porfavor.</li>');
	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list" ).addClass( "parsley-errors-list filled");
	        	
				
	        	
	        	
	        	return true; 
			}else{
				
				
				var clase = $('#username').attr('class'); 
				var id = $('#username').attr('data-parsley-id'); 
				$( "#username" ).removeClass( clase ).addClass( "form-control" );
				$( '#parsley-id-'+id).html('');
	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list filled" ).addClass( "parsley-errors-list");
	        	
	        	
	        	return false; 
				
			}
			
    	
	      
	        
    	
    	
    	
    	

       } 
   
      });
	
	
	
	
	
  }else{}
	
	
	
	
	
	
}









/*

$("#wizard").bwizard({ validating: function (e, ui) { 
	

if(ui.index==1){
	    
		if($( "#nombre" ).val()==""){
		$( "#nombre" ).removeClass( "form-control" ).addClass( "form-control parsley-error" );
		$('#nombre').attr('placeholder', 'Es requerido!');
		
		}else{
			
			$( "#nombre" ).removeClass( "form-control parsley-error" ).addClass( "form-control" );
			$('#nombre').attr('placeholder', '');
			
		}
		
	    if($( "#apaterno" ).val()==""){
			$( "#apaterno" ).removeClass( "form-control" ).addClass( "form-control parsley-error" );
			$('#apaterno').attr('placeholder', 'Es requerido!');
			
			}else{
				$( "#apaterno" ).removeClass( "form-control parsley-error" ).addClass( "form-control" );
				$('#apaterno').attr('placeholder', '');

			}
	    
	    if($( "#edad" ).val()==""){
			$( "#edad" ).removeClass( "form-control" ).addClass( "form-control parsley-error" );
			$('#edad').attr('placeholder', 'Es requerido!');
			
			}else{
				$( "#edad" ).removeClass( "form-control parsley-error" ).addClass( "form-control" );
				$('#edad').attr('placeholder', '');

			}
	    
	    
	    if($( "#rfc" ).val()==""){
			$( "#rfc" ).removeClass( "form-control" ).addClass( "form-control parsley-error" );
			$('#rfc').attr('placeholder', 'Es requerido!');
			
			}else{
				$( "#rfc" ).removeClass( "form-control parsley-error" ).addClass( "form-control" );
				$('#rfc').attr('placeholder', '');

			}
		
		
	}
	
	
	
} });

*/


    var handlecontrollersave = function(){
    	
    	var nombre = $('#nombre').val();    	
    	var apaterno = $('#apaterno').val();
    	var amaterno = $('#amaterno').val();	
		
    	
    	var edad = $('#edad').val();
    	var rfc = $('#rfc').val();
    	
    	var telefonocasa = $('#telefonocasa').val();
    	var telefonooficina = $('#telefonooficina').val();
    	var telefonomovil = $('#telefonomovil').val();
    	
    	
    	var correopersonal = $('#correopersonal').val();
    	var correotrabajo = $('#correotrabajo').val();
    	//var correootro = $('#correootro').val();
	
    	//var facebook = $('#correootro').val();
    	//var twitter = $('#twitter').val();
    	//var otrared = $('#otrared').val();
    	
    	var cp = $('#cp').val();
    	var pais = $('#pais').val();
    	var estado = $('#estado').val();
    	var delmun = $('#delmun').val();
    	var colonia = $('#colonia').val();
    	var calle =  $('#calle').val();
    	var numero = $('#numero').val();
    	
    	var username = $('#username').val();
    	var password = $('#password').val();
    
    	
    	$.ajax({ 
    	    type: "POST",  
            cache: false,
    	    url: "Usuarios.do",  
    	    data: { nombre: nombre, apaterno: apaterno, amaterno : amaterno, edad:edad, rfc:rfc,telefonocasa:telefonocasa,telefonooficina:telefonooficina,correopersonal:correopersonal,correotrabajo:correotrabajo,cp:cp,pais:pais,estado:estado,delmun:delmun,colonia:colonia,calle:calle,numero:numero,username:username,password:password},  
    	    success: function(msg){  
    	    	
    	
    	    	 if(msg.trim()=="existe"){     	        			    
    	  	       
    		        	var clase = $('#username').attr('class'); 
    		        	$( "#username" ).removeClass( clase ).addClass( "form-control parsley-error" );    	        	 
    		        	
    		        	var id = $('#username').attr('data-parsley-id');    	       
    		        	$( '#parsley-id-'+id).html('<li>El usuario ya existe!!, agregue otro por favor.</li>');
    		        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list" ).addClass( "parsley-errors-list filled");
    		        	
    		        	global = 'true'; 
    		        	
    				}else{
    					
    					var idusuario = msg;    					
    					$('#idusuario').val(idusuario); 
    					
    					var clase = $('#username').attr('class'); 
    					var id = $('#username').attr('data-parsley-id'); 
    					$( "#username" ).removeClass( clase ).addClass( "form-control" );
    					$( '#parsley-id-'+id).html('');
    		        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list filled" ).addClass( "parsley-errors-list");
    		        	
    		        	
    		        	global = 'false'; 
    					
    				}
    				
    	    	
    	    	
    	    	
    	    	
    	    	
    	    	
    	            } 
    	           });
	
	
     }


    
    
    
    
    
   
    function existeUsuario(){
    	
    	var ban = false;
    	
    	var username = $('#username').val();
    	
    	if(username!=""){	    	 
    		
    		
    		
    		
    	//$("#preloader").html('<img src="assets/img/load-search.gif" />');
    		
    	
    	$.ajax({ 
        type: "GET",  
        cache: false,
        url: "Usuarios.do",  
        data: "view=ExisteUsuario&username="+username,  
        success: function(msg){  
        	
        	
        	
        	//alert(msg);      	
        	//parsley-id-5371
          	
    	        if(msg.trim()=="existe"){     	        			    
    	       
    	        	//$( "#username" ).addClass( "form-control parsley-error" );
    	        	
    	        	var clase = $('#username').attr('class'); 
    	        	$( "#username" ).removeClass( clase ).addClass( "form-control parsley-error" );    	        	 
    	        	
    	        	
    	        	var id = $('#username').attr('data-parsley-id');    	       
    	        	$( '#parsley-id-'+id).html('<li>El usuario ya existe!!, agregue otro porfavor.</li>');
    	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list" ).addClass( "parsley-errors-list filled");
    	        	
    				//return TRUE; 
    	        	
    	        	ban = true;
    			}else{
    				
    				
    				var clase = $('#username').attr('class'); 
    				var id = $('#username').attr('data-parsley-id'); 
    				$( "#username" ).removeClass( clase ).addClass( "form-control" );
    				$( '#parsley-id-'+id).html('');
    	        	$( '#parsley-id-'+id ).removeClass( "parsley-errors-list filled" ).addClass( "parsley-errors-list");
    	        	
    	        	//return FALSE;
    	        	ban = false;
    				
    			}
    			
        	
    	       // return ban;
    	        
        	
        	
        	
        	
   
           } 
       
          });
    	
    	
    	
    	
    	
      }else{}
    	
    	
    	
    	return ban;
    	
    	
    }
    
    
    
    

    
    

//    $('#username').live("keypress",function(){   	    	
   	 
    $( "#username").change(function() {	    	
    	
    	existeUsuario();  	
    	
    	
    });
    
    
    
    

$( "#btnbuscardireccion" ).click(function() {
	
	var cp = $('#cp').val();
	
	if(cp!=""){
	 
		/*
		$.blockUI({ css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
	            overlayCSS: {backgroundColor: '#FFF'},
                 message: '<img src="skins/default/images/spinner-md.gif" /><br><h3> Espere un momento..</h3>'
                 });
                 */
		
		
		
	$("#preloader").html('<img src="assets/img/load-search.gif" />');
		
	
	$.ajax({ 
    type: "GET",
    cache: false,  
    url: "Usuarios.do",  
    data: "view=getDireccion&cp="+cp,  
    success: function(msg){  
    	
    	var response = msg.split('#%#');
    	
    	$('#pais').val(response[0]);
    	$('#estado').val(response[1]);
    	$('#delmun').val(response[2]);
    	$('#colonia').html(response[3]);
    	
    	$("#preloader").html('');
    	
    	//$('#colonia').html(response[3]);
	
	/*$("#alerta").fadeIn();
				$("#alerta").removeClass();
                $("#alerta").addClass("alert alert-success");
				$("#headAlerta").html("Â¡Correcto!");
				$("#bodyAlerta").html("Se ha guardado el rol del sistema");*/
/*	 
 $.unblockUI();
 */
               } 
   
           });
		   }else{
		   	
			
			
		   }
	
});


//modal
var ListarModal=function(){"use strict";return{init:function(){ 
    
	handleListarModal();
	
}}}()

 


function onkeyup_colfield_checkModal(e){
    var enterKey = 13;
        if (e.which == enterKey){
        	handleListarModal()
        }
}

    function changeShowModal(){
    	
    	
    	handleListarModal()
    }

    function getPagModal(page){
	
	pag = page;
	 handleListarModal()
    }
    
    
    
    var handleListarModal = function(){
    	
    	 var show =	$("#data-elements-lengthM").val();
         var search =	$("#searchtableM").val();
         
         if(search!=""){ pag=1;}
        
         
   	$('div.block').block({ 
   		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
   	        overlayCSS: {backgroundColor: '#FFF'},
   	         message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
         }); 
   	
       
   	$.ajax({ 
   	    type: "GET",  
        cache: false,
   	    url: "Usuarios.do",  
   	    data: "view=BuscarModal&pg="+pag+"&show="+show+"&search="+search,  
   	    success: function(msg){        	    	
   	    	
   	    	$('div.block').unblock(); 
   	    	$("#listresultados2").html(msg);
   	    	       	    	
   	           	    	
   	    	
   	       } 
   	   
   	    });
       	
   }  
    
    


function AsignarRoles(){      	 	

	var idusuario = $("#idusuario").val();
	
	$("input[name='idrole']:checked").prop("checked",false);
	$("#aceptarmodal2").attr("onClick", "javascript:enviarRole("+idusuario+");");         	
    $('#myModal2').modal('show'); 
    ListarModal.init();  
    //setTimeout("ExisteRoleUsuario("+idusuario+")",900);	  
   
} 



function enviarRole(idusuario){       	  

        	var ban = $("input[name='idrole']:checked").val();
        	  
        	 if(!ban){
        		 
        		alert("Debe elegir un role");
        		
        	 }else{      
        		 
        		// $('#myModal2').modal('hide');  
        		
        		 $('#btnload').html("<a class=\"btn btn-sm btn-primary\" id=\"aceptarmodal2\"  href=\"javascript:;\">Espere...</a>");
				  $('#aceptarmodal2').attr("disabled", true);
				// $('#btnload').html("<a class=\"btn btn-sm btn-primary\" href=\"javascript:;\"><i class=\"ion-load-d fa-2x text-inverse\"></i></a>");
        		 var idrole = $('input[name=idrole]:checked').val();         		
        		 AgregarRoleUsuario(idusuario,idrole);       		 
        		 
        		
        	 }
         }
        
                
        
        
        function AgregarRoleUsuario (idusuario,idrole){     	
        
        	
        	$('div.block').block({ 
     		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
     	        overlayCSS: {backgroundColor: '#FFF'},
     	         message: '<img src="assets/img/load-search.gif" /><br><h2> Guardando, espere un momento...</h2>'
           }); 
     	    
        	
        	$.ajax({ 
           	    type: "GET", 
                cache: false, 
           	    url: "Usuarios.do",  
           	    data: "view=AgregarRoleUsuario&idusuario="+idusuario+"&idrole="+idrole,  
           	    success: function(msg){      
        	    	
           	      //  $("input:radio").prop('checked', false); 
           	       // $('#myModal2').modal('hide');
           	       
					
					
        	    	 //$('div.block').unblock();  
        	    	
            	    	
        	    	if(msg.trim()==""){    


                         setTimeout("window.location.href = 'Usuarios.do?alert'",0);					
         	    	 
        	    		
        		        	
        			}else{
        				
        				 setTimeout("window.location.href = 'Usuarios.do'",0);	
        					
        			  }   	    	
        	    	
        	    	
        	      } 
        	 });
    	
    	
         }
        
		
		 jQuery.fn.getCheckboxValues = function(){
        var values = [];
        var i = 0;
        this.each(function(){
            // guarda los valores en un array
            values[i++] = this.id;
        });
        // devuelve un array con los checkboxes seleccionados
        return values;
    }















