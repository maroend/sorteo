/*   
App Sorteo Anáhuac
Version: 1.0
Website: http://www.redanahuac.mx/app/sorteo
*/

var ultimoFolio='';
var pkboletoultimo='';


var pag = 1;

function initialize(){
	limpia();
}

function limpia()
{
	$('#inombre').val('');
	$('#iapellidos').val('');
	$('#itelefonofijo').val('');
	$('#itelefonomovil').val('');
	$('#icorreo').val('');
	$('#icalle').val('');
	$('#inumero').val('');
	$('#icolonia').val('');
	$('#icolonia').html('');
	
	$('#icp').val('');//nuevo	
	$('#imunicipio').val('');//**
	$('#iestado').val('');//**	
	
	 $('#idCompradorActual').val('');
	 $('#idCompradorNuevo').val('');
	 
		$("#btnSubmit").prop('disabled', true);
	 
	
	$('#btnRegistrar').addClass('disabled');
	
	$('#img_icono_bien').hide();
	$('#img_icono_error').hide();
	$('#barcodeboleto').val('');
	$("#barcodeboleto").prop('disabled', false);
	$('#barcodeboleto').focus();
}

function onkeyup_boleto_check(e)
{
	$('#img_icono_bien').hide();
	$('#img_icono_error').hide();
	var code = (e.which) ? e.which : e.keyCode;
	
	if(code==8)
	{
		//backspace
		return true;
	}
	else if(code>=48 && code<=57)
	{
		return true;
	}
	else if(code==13)
	{  pag=1;
		obtenerTalonario();
		return true;
	}
	else
	{
		//$("#barcodeboleto").val('');
		return false;
	}
}
function input_boleto_onkeyup(event)
{
	$('#img_icono_bien').hide();
	$('#img_icono_error').hide();
}




/***********************nueva funcionalidad modal********************************/

//MODAL 2

function CompradoresModal(){        	
 	
 	$("#aceptarmodal3").attr("onClick", "javascript:BuscarCompradoresModal();return false;");         	
     $('#myModal3').modal('show');            
     //$("#listresultados3").html("");
     handleListarUsuariosModal();  
    
 }  

/*jQuery.fn.getCheckboxValues = function(){
    var values = [];
    var i = 0;
    this.each(function(){
        // guarda los valores en un array
        values[i++] = this.id;
    });
    // devuelve un array con los checkboxes seleccionados
    return values;
}*/
    

function BuscarCompradoresModal(){
	
	var comprador = $('input:radio[name=selectusuario]:checked').val()	
	
	if(comprador==""){
		
		alert("Debe seleccionar un comprador.");
		
	}else{		
		
		
		// Ahora consultamos si ya existe un comprador.
		$.ajax({
			type: 'GET',
			cache: false, 
			url: 'RegistroVenta',
			data: 'view=getSoloComprador&pkcomprador='+comprador,
			complete: function(msg){
				
				$('#btnRegistrar').removeClass('disabled');
				
				//$("#btnSubmit").prop('disabled', false);
				
			},
			success: function(msg){				
				
				if(msg==null || msg.trim()=='null'){
				}
				else{
					var array = msg.split('|');
					if(10<=array.length){
						$('#inombre').val(array[0]);
						$('#iapellidos').val(array[1]);
						$('#itelefonofijo').val(array[2]);
						$('#itelefonomovil').val(array[3]);
						$('#icorreo').val(array[4]);
						$('#icalle').val(array[5]);
						$('#inumero').val(array[6]);
						
						$('#iestado').val(array[8]);
						$('#imunicipio').val(array[9]);
						$('#icp').val(array[10]);					
                       $('#icolonia').html(array[11]);
                       
                       $('#idCompradorNuevo').val(array[12]);	
						//arriba
						$('#icolonia option:contains("' + array[7] + '")').prop('selected', true);
						
						  $('#myModal3').modal('hide');    
						
					}
				}
				$('#inombre').focus();
			},
			error : function(msg){
				//console.log('getComprador/ajax/error');
			}
		});
		
			
		
	}
	
	
}
    



function onkeyup_colfield_checkModalUsuario(e){
    var enterKey = 13;
        if (e.which == enterKey){
        	pag=1;
        	handleListarUsuariosModal(); 
        }
}

    function changeShowModalUsuario(){
    	pag=1;
    	handleListarUsuariosModal();
    }

    function getPagModalUsuario(page){
	
	pag = page;
	handleListarUsuariosModal();
    }


 /*fin modal asignar usuario modal */


    function onkeyup_colfield_checkModal(e){
        var enterKey = 13;
            if (e.which == enterKey){
            	pag=1;
            	handleListarUsuariosModal();
            }
    }



function handleListarUsuariosModal(){
	
    //	alert('entro');
            	
   	 var show =	$("#data-elements-lengthMUsuario").val();
   	 
   	// alert(show);
     var search =	$("#searchtableMUsuario").val();
       
     
        
  	 $('div.block').block({ 
  		    css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
  	        overlayCSS: {backgroundColor: '#FFF'},
  	         message: '<img src="assets/img/load-search.gif" /><br><h2> Buscando..</h2>'
        }); 
  	
      
  	$.ajax({ 
  	    type: "GET",  
        cache: false,
  	    url: "RegistroVenta",  
  	    data: "view=BuscarModal&pg="+pag+"&show="+show+"&search="+btoa(search),  
  	    success: function(msg){        	    	
  	    	
  	    	$('div.block').unblock(); 
  	    	$("#listresultados3").html(msg);
  	    	       	    	
  	           	    	
  	    	
  	       } 
  	   
  	    });
      	
  }  
    



/**********dirección cp******/



$("#btnbuscardireccion").click(function ()
		{
			var cp = $('#i_cp').val();

			var colonia = $('#i_colonia').val();
			/*
			$.blockUI({ css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
			        overlayCSS: {backgroundColor: '#FFF'},
		                message: '<img src="skins/default/images/spinner-md.gif" /><br><h3> Espere un momento..</h3>'
		                });
		                */
			
			$("#preloader").html('<img src="assets/img/load-search.gif" />');

			$.ajax({
				type: "GET",
				url: "Colaboradores.do",
				data: "view=getDireccion&cp=" + cp,
				success: function (msg) {
					
					var data = jQuery.parseJSON(msg);

					$('#i_cp').val(data.cp);				
					$('#i_estado').val(data.estado);
					$('#i_municipio').val(data.mundel);
					$('#i_colonia').html(data.colonias_html);
					
					$('#i_colonia option:contains("' + colonia + '")').prop('selected', true);
					
					$("#preloader").html('');
				}

			});

		});





/************fin dirección*********/






function checaSectorNichoYColaborador(pksector,pknicho,pkcolaborador)
{
	if(pksector==null || pksector=='null'){
		$('#barcodeboleto').val('');
		$("#barcodeboleto").prop('disabled', false);
		$("#barcodeboleto").focus();
		$('#img_icono_error').show();
		$.gritter.add({ title : "Atenci&oacute;n", text : 'El boleto <b style="color:#DED9BF;">'+ultimoFolio+'</b> no est&aacute; asignado a un sector' });
		return false;
	}
	if(pknicho==null || pknicho=='null'){
		$('#barcodeboleto').val('');
		$("#barcodeboleto").prop('disabled', false);
		$("#barcodeboleto").focus();
		$('#img_icono_error').show();
		$.gritter.add({ title : "Atenci&oacute;n", text : 'El boleto <b style="color:#DED9BF;">'+ultimoFolio+'</b> no est&aacute; asignado a un nicho' });
		return false;
	}
	if(pkcolaborador==null || pkcolaborador=='null'){
		$('#barcodeboleto').val('');
		$("#barcodeboleto").prop('disabled', false);
		$("#barcodeboleto").focus();
		$('#img_icono_error').show();
		$.gritter.add({ title : "Atenci&oacute;n", text : 'El boleto <b style="color:#DED9BF;">'+ultimoFolio+'</b> no est&aacute; asignado a un colaborador' });
		return false;
	}
	return true;
}

function validaTexto(texto){
	if(texto==null)
		return false;
	if (0<=texto.indexOf('&') || 0<=texto.indexOf('=') || 0<=texto.indexOf('?') ||
		0<=texto.indexOf('/') || 0<=texto.indexOf('%') || 0<=texto.indexOf('\\'))
		return false;
	return true;
}

function validaCampo(texto, nombreCampo, vacio){
	if(vacio==false && texto==''){
		$.gritter.add({ title : "Atenci&oacute;n", text : 'El campo \''+nombreCampo+'\' no puede ir vac&iacute;o' });
		return false;
	}
	if (validaTexto(texto, vacio))
		return true;
	else{
		$.gritter.add({ title : "Atenci&oacute;n", text : 'El campo \''+nombreCampo+'\' no admite los simbolos:  &, =, ?, /,\\,% ' });
		return false;
	}
}
function InsertarComprador(){
//  (idsorteo,boleto,talonario,costo,pktalonario,pkboleto,pksector,pknicho,pkcolaborador) {
	
	if($('#icp').val()==null/*$('#imunicipio').val()==null*/){
		$.gritter.add({ title : "Atenci&oacute;n", text : 'El campo \'Codigo Postal\' no puede ir vac&iacute;o ' });
		//$.gritter.add({ title : "Atenci&oacute;n", text : 'El campo \'Municipio o Delegaci&oacute;n\' no puede ir vac&iacute;o ' });
		return;
	}
	var comprador={
		nombre : ($('#inombre').val()).trim()
		, apellidos : ($('#iapellidos').val()).trim()
		, telefonofijo : ($('#itelefonofijo').val()).trim()
		, telefonomovil : ($('#itelefonomovil').val()).trim()
		, correo : ($('#icorreo').val()).trim()
		, calle : ($('#icalle').val()).trim()
		, numero : ($('#inumero').val()).trim()
		, colonia : ($('#icolonia').find('option:selected').text()).trim()
		, estado : $('#iestado').val().trim()
		, municipio : $('#imunicipio').val().trim()	
		, cp : $('#icp').val().trim()
		//, colonia : ($('#icolonia').val()).trim()
		//, estado : ($('#iestado').find('option:selected').text()).trim()
		//, municipio : ($('#imunicipio').find('option:selected').text()).trim()
	
	};
	
	if (!validaCampo(comprador.nombre,'Nombre',false) ||
		!validaCampo(comprador.apellidos,'Apellidos',false) ||
		!validaCampo(comprador.telefonofijo,'Telefono Fijo',true) ||
		!validaCampo(comprador.telefonomovil,'Telefono Movil',true) ||
		!validaCampo(comprador.correo,'Correo Electrónico',true) ||
		!validaCampo(comprador.calle,'Calle',false) ||
		!validaCampo(comprador.numero,'Numero',false) ||
		!validaCampo(comprador.colonia,'Colonia',false) ||
		!validaCampo(comprador.estado,'Estado',false) ||
		!validaCampo(comprador.municipio,'Municipio o Delegaci&oacute;n',false)
		)
		return;
	
		
	      var idcompradorA;
	      if($('#idCompradorActual').val()=='')
	    	  var idcompradorA=0;
	      else
	    	  idcompradorA=$('#idCompradorActual').val();	    	  
	    	  
	    	  
	
	$.ajax({
		type : "POST",
		cache : false,
		url : "BoletosSorteo",
		data : {
			operacion : 'InsertComprador',
			extra: 'SoloComprador',
			
			// datos del BOLETO
			boleto : _boleto.boleto,
			pkboleto : _boleto.pkboleto,
			talonario : _boleto.talonario,
			pktalonario : _boleto.pktalonario,
			sorteo : _boleto.pksorteo,
			pksector : _boleto.pksector,
			pknicho : _boleto.pknicho,
			pkcolaborador : _boleto.pkcolaborador,
			costo : _boleto.costo,
			abono : _boleto.abono,
			
			// datos del COMPRADOR
			idCompradorA : idcompradorA,//new
			idCompradorN : $('#idCompradorNuevo').val(),//new
			nombre : comprador.nombre,
			apellidos : comprador.apellidos,
			telefonofijo : comprador.telefonofijo,
			telefonomovil : comprador.telefonomovil,
			correo : comprador.correo,
			calle : comprador.calle,
			numero : comprador.numero,
			colonia : comprador.colonia,
			estado : comprador.estado,
			municipio : comprador.municipio,
			cp : comprador.cp,
		},
		success : function(msg)
		{
			
			
			$('#img_icono_bien').show();
			$.gritter.add({
				title : "Correcto",
				text : 'El comprador se ha registrado con exito!',
			});
			//limpia();
			/*
			$('#inombre').val('');
			$('#iapellidos').val('');
			$('#itelefonofijo').val('');
			$('#itelefonomovil').val('');
			$('#icorreo').val('');
			$('#icalle').val('');
			$('#inumero').val('');
			$('#icolonia').val('');
			//*/
			//$('#barcodeboleto').val('');
			
			$('#btnRegistrar').addClass('disabled');
			
			//$("#barcodeboleto").prop('disabled', false);
			//$("#barcodeboleto").focus();
			
			
			$("#idCompradorActual").val($("#idCompradorNuevo").val());
			$("#idCompradorNuevo").val('');
			
			//console.log('msg:'+msg);
		},
		error : function(msg){
			limpia();
			//console.log('InsertarVentaComprador/ 1 /ajax/error');
		}
	});
}



var _boleto=null;
function obtenerTalonario(){
	
	var folio = $('#barcodeboleto').val().trim();
	if (folio==''){
		$.gritter.add({ title : "ATENCION", text : 'Por favor escriba el folio del boleto a vender' });
		return;
	}
	$("#barcodeboleto").prop('disabled', true);
	ultimoFolio = folio;
	$.ajax({
		type: "GET",
		cache: false, 
		url: "RegistroVenta",  
		data: "view=getTalonario&folio="+folio,  
		success: function(msg){
			console.log('msg: \''+msg+'\'');

			if(msg==null || msg.trim()=='null'){
				
				$('#img_icono_error').show();
				$("#barcodeboleto").prop('disabled', false);
				$.gritter.add({ title : "Atenci&oacute;n", text : 'El boleto <b style="color:#DED9BF;">'+ultimoFolio+'</b> no existe' });
				$("#barcodeboleto").focus();
				return;
			}
			
			var res = msg.split("|");
			
			_boleto={
				boleto: ultimoFolio,
				talonario: res[0],
				costo: res[4],
				abono: res[13],
				
				pkboleto: res[6],
				pktalonario: res[5],
				pksorteo: res[3],
				pksector: res[7],
				pknicho: res[8],
				pkcolaborador: res[9],
				
				vendido: res[10],
				asignado: res[11],
				incidencia: res[12],
			};
			
			
			pkboletoultimo = res[6];
			
			
			if(res[14].trim()=='1'){
				$('#img_icono_error').show();
				$("#barcodeboleto").prop('disabled', false);
				$.gritter.add({ title : "Atenci&oacute;n", text : 'El boleto <b style="color:#DED9BF;">'+ultimoFolio+'</b> no es f&iacute;sico' });
				$("#barcodeboleto").focus();
				return;
			}		
			
			
			
			// Boleto NO vendido
			if(_boleto.vendido.trim()=='N'){
				$('#img_icono_error').show();
				$("#barcodeboleto").prop('disabled', false);
				$.gritter.add({ title : "Atenci&oacute;n", text : 'El boleto <b style="color:#DED9BF;">'+ultimoFolio+'</b> no est&aacute; vendido' });
				$("#barcodeboleto").focus();
				return;
			}
			
			if(checaSectorNichoYColaborador(_boleto.pksector, _boleto.pknicho, _boleto.pkcolaborador)==false){
				limpia();
				return;
			}
			//console.log('getComprador...');
			
			// Ahora consultamos si ya existe un comprador.
			$.ajax({
				type: 'GET',
				cache: false, 
				url: 'RegistroVenta',
				data: 'view=getComprador&boleto='+folio+"&pkboleto="+pkboletoultimo,
				complete: function(msg){
				//	$('#btnRegistrar').removeClass('disabled');
					
					$("#btnSubmit").prop('disabled', false);
					
				},
				success: function(msg){
					
					//alert(msg);
					
					if(msg==null || msg.trim()=='null' || msg.trim()==''){
						
						//$('#btnRegistrar').removeClass('disabled');
						
					}
					else{
						
						
						var array = msg.split('|');
						if(10<=array.length){
							$('#inombre').val(array[0]);
							$('#iapellidos').val(array[1]);
							$('#itelefonofijo').val(array[2]);
							$('#itelefonomovil').val(array[3]);
							$('#icorreo').val(array[4]);
							$('#icalle').val(array[5]);
							$('#inumero').val(array[6]);
							
							$('#iestado').val(array[8]);
							$('#imunicipio').val(array[9]);
							$('#icp').val(array[10]);
							//$('#icolonia').val(array[7]);
							
							
	                       $('#icolonia').html(array[11]);
	                       
	                       $('#idCompradorActual').val(array[12]);
	                       
	                       
							
							//arriba
							$('#icolonia option:contains("' + array[7] + '")').prop('selected', true);
							
						//	$("#iestado option:contains('" + array[8] + "')").attr('selected', 'selected');
														
						
							
							
							/*getMunicipios(
									function(parametro)
									{
										$("#imunicipio option:contains('" + parametro + "')").attr('selected', 'selected');
									},
									array[9]
							);*/
						}
					}
					$('#inombre').focus();
				},
				error : function(msg){
					//console.log('getComprador/ajax/error');
				}
			});
			
			
	    },
		error : function(msg){
			//console.log('getTalonario/ajax/error');
		},
	    statusCode :{
	    	302: function() {
	    		alert('Se ha terminado la sesion');
	    	}
	    }
	});
	
}




function eliminarCompradorBoleto(idComprador) {

	
	
	var confirm = window.confirm("Esta seguro de Borrar el Comprador-Boleto?");
	if (confirm == true)
	{
		divBlock("Borrando...");
		
				
		
		
		$.ajax({
			type : "POST",
			cache : false,
			url : "BoletosSorteo",
			data : {
				operacion : 'InsertComprador',
				extra: 'SoloComprador',
				
				// datos del BOLETO
				boleto : _boleto.boleto,
				pkboleto : _boleto.pkboleto,
				talonario : _boleto.talonario,
				pktalonario : _boleto.pktalonario,
				sorteo : _boleto.pksorteo,
				pksector : _boleto.pksector,
				pknicho : _boleto.pknicho,
				pkcolaborador : _boleto.pkcolaborador,
				costo : _boleto.costo,
				abono : _boleto.abono,
				
				// datos del COMPRADOR
				idCompradorA : idcompradorA,//new
				idCompradorN : $('#idCompradorNuevo').val(),//new
				/*nombre : comprador.nombre,
				apellidos : comprador.apellidos,
				telefonofijo : comprador.telefonofijo,
				telefonomovil : comprador.telefonomovil,
				correo : comprador.correo,
				calle : comprador.calle,
				numero : comprador.numero,
				colonia : comprador.colonia,
				estado : comprador.estado,
				municipio : comprador.municipio,
				cp : comprador.cp,*/
			},
			success : function(msg)
			{
				
				
				$('#img_icono_bien').show();
				$.gritter.add({
					title : "Correcto",
					text : 'El comprador se ha registrado con exito!',
				});
				limpia();/********checar******/
				
				$('#btnRegistrar').addClass('disabled');
				
				//$("#barcodeboleto").prop('disabled', false);
				//$("#barcodeboleto").focus();
				
				
				$("#idCompradorActual").val($("#idCompradorNuevo").val());
				$("#idCompradorNuevo").val('');
				
				//console.log('msg:'+msg);
			},
			error : function(msg){
				limpia();
				//console.log('InsertarVentaComprador/ 1 /ajax/error');
			}
		});
		
		
		
		
		
		
		
		
		
		
		
		
	
		/*$.ajax({
			type : "GET",
			cache : false,
			url : "RegistroComprador",
			data : "view=Borrar&idComprador=" + idComprador,
			success : function(msg) {
				$('div.block').unblock();
				
				var data=jQuery.parseJSON(msg);
				
				if (data.result == 'OK')
					$.gritter.add({ title: "CORRECTO", text: "se Elimino el comprador" });
				else
					$.gritter.add({ title: "ERROR !", text: data.msg });

				pag = 1;
				Listar.init();
			},
			error : function(msg) {
				$('div.block').unblock();
				$.gritter.add({ title: "ERROR !", text: msg });
			}
		});*/
	}
}






//-------------------------------------------

function getMunicipios(f_success, f_success_parmetros) {

	var idestado = $('#iestado').find('option:selected').val();
	var estado = $('#iestado').find('option:selected').text();

	$.ajax({
		type : "GET",
		cache : false,
		url : "BoletosSorteo",
		data : "view=getMunicipios&idestado=" + idestado + "&estado=" + estado,
		success : function(msg) {
			
			$('#imunicipio').html(msg);
			
			if(f_success!=null)
				f_success(f_success_parmetros);
		},
		error : function(msg){
			//console.log('getMunicipios/ajax/error');
		}

	});

}

function CancelarComprador(){
	limpia();
}



/***************************************tab2 compradores*********************************/


var Listar = function() {
	"use strict";
	return {
		init : function() {
			handleListar();
		}
	}
}()

$(function() {
	$('#alerta').hide();
	$(window).load(function() {
		Listar.init();
	});
});


function onkeyup_colfield_check(e) {
	var enterKey = 13;
	if (e.which == enterKey) {
		pag=1;
		handleListar()
	}
}

function changeShow() {
	pag=1;
	handleListar()
}

function getPag(page) {
	pag = page;
	handleListar();
}

var handleListar = function() {

	var show = $("#data-elements-length").val();
	var search = $("#searchtable").val();
	//alert(search);

	divBlock('Buscando...');

	$.ajax({
		type: "GET",
		cache: false,
		url: "RegistroComprador",
		data: "view=Buscar&pg="+pag+"&show="+show+"&search="+btoa(search),
		success: function(msg){
			
			$('div.block').unblock();
			$("#listresultados").html(msg);
		}
	});
}

function divBlock(msg) {
	$('div.block').block({
		css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
		overlayCSS: {backgroundColor: '#FFF'},
		message: '<img src="assets/img/load-search.gif" /><br><h2> '+msg+' </h2>'
	});
}



function BuscarEditar(idcomprador){


	divBlock('Buscando...');

	$.ajax({
		type: "GET",
		cache: false,
		url: 'RegistroVenta',
		data: 'view=getSoloComprador&pkcomprador='+idcomprador,
		success: function(msg){
			
			$("#btnSubmitFrm").text('Guardar cambios');
			$("#btnSubmitFrm").attr("onClick", "javascript:Actualizar('"+idcomprador+"');return false;");

			if(msg==null || msg.trim()=='null'){
			}
			else{
				var array = msg.split('|');
				if(10<=array.length){
					$('#i_nombre').val(array[0]);
					$('#i_apellidos').val(array[1]);
					$('#i_telefonofijo').val(array[2]);
					$('#i_telefonomovil').val(array[3]);
					$('#i_correo').val(array[4]);
					$('#i_calle').val(array[5]);
					$('#i_numero').val(array[6]);
					
					$('#i_estado').val(array[8]);
					$('#i_municipio').val(array[9]);
					$('#i_cp').val(array[10]);					
                   $('#i_colonia').html(array[11]);
                   
                   //$('#idCompradorNuevo').val(array[12]);	
					//arriba
					$('#i_colonia option:contains("' + array[7] + '")').prop('selected', true);					
					 
					
				}
			}
			$('#i_nombre').focus();		
			
			//$('#formulario').parsley().validate();
			$('html, body').animate({scrollTop:0}, 10);
		},
		complete: function() {
			$('div.block').unblock();
		},
		
		
		
		
	});
}



function InsertarSoloComprador(idComprador){
//  (idsorteo,boleto,talonario,costo,pktalonario,pkboleto,pksector,pknicho,pkcolaborador) {
	
	if($('#i_cp').val()==null/*$('#imunicipio').val()==null*/){
		$.gritter.add({ title : "Atenci&oacute;n", text : 'El campo \'Codigo Postal\' no puede ir vac&iacute;o ' });
		//$.gritter.add({ title : "Atenci&oacute;n", text : 'El campo \'Municipio o Delegaci&oacute;n\' no puede ir vac&iacute;o ' });
		return;
	}
	var compradorfrm={
		nombre : ($('#i_nombre').val()).trim()
		, apellidos : ($('#i_apellidos').val()).trim()
		, telefonofijo : ($('#i_telefonofijo').val()).trim()
		, telefonomovil : ($('#i_telefonomovil').val()).trim()
		, correo : ($('#i_correo').val()).trim()
		, calle : ($('#i_calle').val()).trim()
		, numero : ($('#i_numero').val()).trim()
		, colonia : ($('#i_colonia').find('option:selected').text()).trim()
		, estado : $('#i_estado').val().trim()
		, municipio : $('#i_municipio').val().trim()	
		, cp : $('#i_cp').val().trim()
		//, colonia : ($('#icolonia').val()).trim()
		//, estado : ($('#iestado').find('option:selected').text()).trim()
		//, municipio : ($('#imunicipio').find('option:selected').text()).trim()
	
	};
	
	if (!validaCampo(compradorfrm.nombre,'Nombre',false) ||
		!validaCampo(compradorfrm.apellidos,'Apellidos',false) ||
		!validaCampo(compradorfrm.telefonofijo,'Telefono Fijo',true) ||
		!validaCampo(compradorfrm.telefonomovil,'Telefono Movil',true) ||
		!validaCampo(compradorfrm.correo,'Correo Electrónico',true) ||
		!validaCampo(compradorfrm.calle,'Calle',false) ||
		!validaCampo(compradorfrm.numero,'Numero',false) ||
		!validaCampo(compradorfrm.colonia,'Colonia',false) ||
		!validaCampo(compradorfrm.estado,'Estado',false) ||
		!validaCampo(compradorfrm.municipio,'Municipio o Delegaci&oacute;n',false)
		)
		return;
	
	
	/*var idComprador_;
	if( idComprador==0 )
		idComprador_ = 0;
	else
		idComprador_ = $('#idComprador').val();*/
		   	  
	
	$.ajax({
		type : "POST",
		cache : false,
		url : "BoletosSorteo",
		data : {
			operacion : 'InsertSoloComprador',		
			// datos del COMPRADOR		
			idComprador : idComprador ,//new
			nombre : compradorfrm.nombre,
			apellidos : compradorfrm.apellidos,
			telefonofijo : compradorfrm.telefonofijo,
			telefonomovil : compradorfrm.telefonomovil,
			correo : compradorfrm.correo,
			calle : compradorfrm.calle,
			numero : compradorfrm.numero,
			colonia : compradorfrm.colonia,
			estado : compradorfrm.estado,
			municipio : compradorfrm.municipio,
			cp : compradorfrm.cp,
		},
		success : function(msg)
		{			
			
			//$('#img_icono_bien').show();
			if(idComprador==0){
				
				$.gritter.add({
					title : "Correcto",
					text : 'El comprador se ha registrado con exito!',
				});
				
				
			}else{
				
				$.gritter.add({
					title : "Correcto",
					text : 'El comprador se ha editado con exito!',
				});
				
			}
			
			
			$('#i_nombre').val('');
			$('#i_apellidos').val('');
			$('#i_telefonofijo').val('');
			$('#i_telefonomovil').val('');
			$('#i_correo').val('');
			$('#i_calle').val('');
			$('#i_numero').val('');
			$('#i_colonia').val('');
			$('#i_colonia').html('');
			
			$('#i_cp').val('');//nuevo	
			$('#i_municipio').val('');//**
			$('#i_estado').val('');//**	
			
			
			Listar.init();
			
			//$("#idComprador").val('');
			
			//console.log('msg:'+msg);
		},
		error : function(msg){
			limpia();
			//console.log('InsertarVentaComprador/ 1 /ajax/error');
		}
	});
}



function Actualizar(idcomprador){

//	if( $('#formulario').parsley().validate())
	//{			idcomprador	
	       
			 InsertarSoloComprador(idcomprador);
			 
			 $("#btnSubmitFrm").attr("onClick","javascript:InsertarSoloComprador(0);return false;");
				$("#btnSubmitFrm").text('Agregar');
		
	//}
}



function Borrar(idComprador) {

	var confirm = window.confirm("Esta seguro de Borrar el Comprador?");
	if (confirm == true)
	{
		divBlock("Borrando...");
	
		$.ajax({
			type : "GET",
			cache : false,
			url : "RegistroComprador",
			data : "view=Borrar&idComprador=" + idComprador,
			success : function(msg) {
				$('div.block').unblock();
				
				var data=jQuery.parseJSON(msg);
				
				if (data.result == 'OK')
					$.gritter.add({ title: "CORRECTO", text: "se Elimino el comprador" });
				else
					$.gritter.add({ title: "ERROR !", text: data.msg });

				pag = 1;
				Listar.init();
			},
			error : function(msg) {
				$('div.block').unblock();
				$.gritter.add({ title: "ERROR !", text: msg });
			}
		});
	}
}












