/*   
App Sorteo An√°huac
Version: 1.0
Website: http://www.redanahuac.mx/app/sorteo
*/


var pag = 1;

var Listar = function () {
	"use strict"; return {
		init: function () {

			handleListar();
		}
	}
}()

$(document).ready(function () {

	$('#alerta').hide();
	handlebuscarSectores();

});

$('#idsectorb').change(function (e) {
	pag = 1;
	e.preventDefault();
	handlebuscarNichosSector();
});

$('#idnichob').change(function (e) {
	pag = 1;
	e.preventDefault();
	Listar.init();

});

function divBlock(msg) {
	$('div.block').block({
		css: { backgroundColor: 'transparent', color: '#336B86', border:"null" },
		overlayCSS: {backgroundColor: '#FFF'},
		message: '<img src="assets/img/load-search.gif" /><br><h2> '+msg+' </h2>'
	});
}

function divUnblock() {
	$('div.block').unblock();
}

function onkeyup_colfield_check(e) {
	if (e.which == 13) {
		var search = $("#searchtable").val();
		if (search.trim() != "") { pag = 1; }
		Listar.init();
	}
}


function changeShow() {
	getPag(1);
}


function getPag(page) {
	pag = page;
	Listar.init();
}


function btnSearch(){
	getPag(1);
}


var handleListar = function () {

	var show = $("#data-elements-length").val();
	var search = btoa($("#searchtable").val());

	var idsectorb = $("#idsectorb").val();
	var idnichob = $("#idnichob").val();

	divBlock("Buscando...");

	$.ajax({
		type: "GET",
		url: "ConciliacionFisica",
		data: "view=Buscar&pg=" + pag + "&show=" + show + "&search=" + search + "&idsectorb=" + idsectorb + "&idnichob=" + idnichob,
		success: function (msg) {

			divUnblock();
			$("#listresultados").html(msg);
		},
		error: function(msg) {
			divUnblock();
			$('#listresultados').html(__msg_sin_conexion);
		}

	});
}


//busca sectores al comienzo de cargar la pagina 
function handlebuscarSectores() {

	var usuario = $("#usuario").val();
	var idsectorU = $("#idsectorU").val();

	divBlock("Buscando..");

	$.ajax({
		type: "GET",
		url: "ConciliacionFisica",
		data: "view=BuscarSectorInicio" + "&idsectorU=" + idsectorU + "&usuario=" + usuario,
		success: function (msg) {

			$("#idsectorb").html(msg);
			handlebuscarNichosSector();
			divUnblock();

		}

	});
}



function handlebuscarNichosSector() {

	idsector = $('#idsectorb').val();

	if (idsector != "" && idsector != "0") {

		$.ajax({
			type: "GET",
			url: "ConciliacionFisica",
			data: "view=buscarNichosSectorInicio&idsector=" + idsector,
			success: function (msg) {

				$("#idnichob").html(msg);

				Listar.init();
			}
		});

	} else {
		$("#idnichob").html("<option value=\"0\">Todos</option>");
		Listar.init();
	}
}

function Conciliacion_1() {
	location.href = "Conciliacion";
}

function Conciliacion_2() {
	location.href = "ConciliacionElectronica";
}

function Conciliacion_3() {
	//location.href = "ConciliacionFisica";
}

function ExportExcel() {

	var show = $("#data-elements-length").val();
	var search = $("#searchtable").val();

	var idsectorb = $("#idsectorb").val();
	var idnichob = $("#idnichob").val();

	if (search != "") { pag = 1; }

	location.href = "ConciliacionFisica?view=ExportExcel&pg=" + pag + "&show=" + show + "&search=" + search + "&idsectorb=" + idsectorb + "&idnichob=" + idnichob;
}


